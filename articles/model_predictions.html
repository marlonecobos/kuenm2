<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5. Project Models to a Single Scenario • kuenm2</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="5. Project Models to a Single Scenario">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">kuenm2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-book"></span> Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic_data_cleaning.html">1. Basic Data Cleaning</a></li>
    <li><a class="dropdown-item" href="../articles/prepare_data.html">2. Prepare Data for Model Calibration</a></li>
    <li><a class="dropdown-item" href="../articles/model_calibration.html">3. Model Calibration</a></li>
    <li><a class="dropdown-item" href="../articles/model_exploration.html">4. Fit and Explore Selected Models</a></li>
    <li><a class="dropdown-item" href="../articles/model_predictions.html">5. Project Models to a Single Scenario</a></li>
    <li><a class="dropdown-item" href="../articles/model_projections.html">6. Project Models to Multiple Scenarios</a></li>
    <li><a class="dropdown-item" href="../articles/variability_and_uncertainty.html">7. Exploring Model Uncertainty and Variability</a></li>
    <li><a class="dropdown-item" href="../articles/projections_chelsa.html">8. Example of Projections Using CHELSA Data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/marlonecobos/kuenm2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>5. Project Models to a Single Scenario</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/marlonecobos/kuenm2/blob/main/vignettes/model_predictions.Rmd" class="external-link"><code>vignettes/model_predictions.Rmd</code></a></small>
      <div class="d-none name"><code>model_predictions.Rmd</code></div>
    </div>

    
    
<ul>
<li><a href="#introduction">Introduction</a></li>
<li>
<a href="#predict-selected-models-for-a-single-scenario">Predict
selected models for a single scenario</a>
<ul>
<li><a href="#predict-to-spatraster">Predict to SpatRaster</a></li>
<li><a href="#predict-to-data.frame">Predict to data.frame</a></li>
<li><a href="#binarize-models">Binarize models</a></li>
<li><a href="#clamping-variables">Clamping variables</a></li>
<li><a href="#no-extrapolation">No Extrapolation</a></li>
<li><a href="#output-type">Output Type</a></li>
</ul>
</li>
<li><a href="#saving-predictions">Saving Predictions</a></li>
</ul>
<hr>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>Once selected models have been fit using <code><a href="../reference/fit_selected.html">fit_selected()</a></code>,
projections to single or multiple scenarios can be performed. The
<code><a href="../reference/predict_selected.html">predict_selected()</a></code> function is designed for projections to
single scenarios.</p>
<p>To predict using the selected models, a <code>fitted_models</code>
object is required. For detailed information on model fitting, please
consult the vignette <a href="model_exploration.html">Fit and Explore
Selected Models</a>. The <code>fitted_models</code> object generated in
that vignette is included as an example dataset within the package.
Let’s load it.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marlonecobos.github.io/kuenm2/">kuenm2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.86</span></span>
<span></span>
<span><span class="co">#Import calib_results_maxnet</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fitted_model_maxnet"</span>, package <span class="op">=</span> <span class="st">"kuenm2"</span><span class="op">)</span></span>
<span><span class="co">#Print calibration result</span></span>
<span><span class="va">fitted_model_maxnet</span></span>
<span><span class="co">#&gt; fitted_models object summary</span></span>
<span><span class="co">#&gt; ============================</span></span>
<span><span class="co">#&gt; Species: Myrcia hatschbachii </span></span>
<span><span class="co">#&gt; Algortihm: maxnet </span></span>
<span><span class="co">#&gt; Number of fitted models: 2 </span></span>
<span><span class="co">#&gt; Only full models fitted, no replicates</span></span></code></pre></div>
<p>To compare the results, let’s import a <code>fitted_models</code>
object generated using the GLM algorithm:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Import calib_results_maxnet</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fitted_model_glm"</span>, package <span class="op">=</span> <span class="st">"kuenm2"</span><span class="op">)</span></span>
<span><span class="co">#Print calibration result</span></span>
<span><span class="va">fitted_model_glm</span></span>
<span><span class="co">#&gt; fitted_models object summary</span></span>
<span><span class="co">#&gt; ============================</span></span>
<span><span class="co">#&gt; Species: Myrcia hatschbachii </span></span>
<span><span class="co">#&gt; Algortihm: glm </span></span>
<span><span class="co">#&gt; Number of fitted models: 1 </span></span>
<span><span class="co">#&gt; Only full models fitted, no replicates</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level2">
<h2 id="predict-selected-models-for-a-single-scenario">Predict Selected Models for a Single Scenario<a class="anchor" aria-label="anchor" href="#predict-selected-models-for-a-single-scenario"></a>
</h2>
<p>To predict selected models for a single scenario, you need a
<code>fitted_models</code> object and the corresponding predictor
variables. These predictor variables can be provided as either a
<code>SpatRaster</code> or a <code>data.frame</code>. The names of the
variables (or columns in the <code>data.frame</code>) must precisely
match those used for model calibration or those used when running PCA
(if <code>do_pca = TRUE</code> was set in the
<code><a href="../reference/prepare_data.html">prepare_data()</a></code> function; see <a href="prepare_data.html">Prepare Data for Model Calibration</a> for more
details).</p>
<div class="section level3">
<h3 id="predict-to-spatraster">Predict to SpatRaster<a class="anchor" aria-label="anchor" href="#predict-to-spatraster"></a>
</h3>
<p>Let’s use the same raster variables that were used to prepare the
data and calibrate the models. These are included as example data within
the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import raster layers</span></span>
<span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Current_variables.tif"</span>, package <span class="op">=</span> <span class="st">"kuenm2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#Plot raster layers</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_predictions_files/figure-html/Import%20raster%20layers-1.png" class="r-plt" alt="" width="672"></p>
<p>Let’s check which variables were used to calibrate our models. They
are available in the <code>calibration_data</code> element of the
object:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Variables used to calibrate maxnet models</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">fitted_model_maxnet</span><span class="op">$</span><span class="va">calibration_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "pr_bg"    "bio_1"    "bio_7"    "bio_12"   "bio_15"   "SoilType"</span></span>
<span></span>
<span><span class="co">#Variables used to calibrate glm models</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">fitted_model_glm</span><span class="op">$</span><span class="va">calibration_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "pr_bg"    "bio_1"    "bio_7"    "bio_12"   "bio_15"   "SoilType"</span></span></code></pre></div>
<p>The first column, “pr_bg”, indicates the presence (1) and absence (0)
records, while the other columns represent the environmental variables.
In this case, the variables are <code>bio_1</code>, <code>bio_7</code>,
<code>bio_12</code>, <code>bio_15</code>, and <code>SoilType</code>. All
these variables are present in the <code>SpatRaster</code>
(<code>var</code>) we imported. Therefore, we can now predict our models
to this raster. Let’s begin by predicting the maxnet model:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_maxnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_selected.html">predict_selected</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, </span>
<span>                             new_variables <span class="op">=</span> <span class="va">var</span>,</span>
<span>                             progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>By default, the function computes consensus metrics (mean, median,
range, and standard deviation) for each model across its replicates (if
more than one model was selected), as well as a general consensus across
all models. In this case, the output is a <code>list</code> containing
<code>SpatRaster</code> predictions for each replicate, along with the
consensus results for each model and the overall general consensus:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#See objects in the output of predict_selected</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">p_maxnet</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Model_192"         "Model_219"         "General_consensus"</span></span></code></pre></div>
<p>Let’s plot the general consensus:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_maxnet</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_predictions_files/figure-html/plot%20maxnet%20general-1.png" class="r-plt" alt="" width="672"></p>
<p>We can also plot the results for each replicate and the consensus for
each model:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Predictions for each replicate from model 192</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_maxnet</span><span class="op">$</span><span class="va">Model_192</span><span class="op">$</span><span class="va">Replicates</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_predictions_files/figure-html/plot%20models%20maxnet-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Consensus across each replicate from model 192</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_maxnet</span><span class="op">$</span><span class="va">Model_192</span><span class="op">$</span><span class="va">Model_consensus</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_predictions_files/figure-html/plot%20models%20maxnet-2.png" class="r-plt" alt="" width="672"></p>
<p><br></p>
<p>For comparison, let’s predict the GLM model:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Predict glm model</span></span>
<span><span class="va">p_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_selected.html">predict_selected</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_glm</span>, </span>
<span>                          new_variables <span class="op">=</span> <span class="va">var</span>,</span>
<span>                          progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#See selected models that were predicted</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">p_glm</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Model_85"          "General_consensus"</span></span>
<span></span>
<span><span class="co">#Compare general consensus (mean) between maxnet and glm</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co">#Set grid to plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_maxnet</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span>, main <span class="op">=</span> <span class="st">"Maxnet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_glm</span><span class="op">$</span><span class="va">General_consensus</span>, main <span class="op">=</span> <span class="st">"GLM"</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_predictions_files/figure-html/unnamed-chunk-2-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#Reinitiate grid</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level3">
<h3 id="predict-to-data-frame">Predict to data.frame<a class="anchor" aria-label="anchor" href="#predict-to-data-frame"></a>
</h3>
<p>Instead of a <code>SpatRaster</code>, we can also predict the models
to a <code>data.frame</code> that stores the variable values. To see an
example, let’s convert the raster variables <code>var</code> to a
<code>data.frame</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">var_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;       bio_1    bio_7 bio_12   bio_15 SoilType</span></span>
<span><span class="co">#&gt; 11 22.77717 18.12400   1180 48.03594       NA</span></span>
<span><span class="co">#&gt; 12 22.76711 17.74400   1191 49.31194       10</span></span>
<span><span class="co">#&gt; 13 22.68580 17.46575   1206 51.51922       10</span></span>
<span><span class="co">#&gt; 14 22.50121 17.84525   1228 53.90265       10</span></span>
<span><span class="co">#&gt; 15 22.07609 18.14125   1254 54.10397       10</span></span>
<span><span class="co">#&gt; 16 21.88485 18.80800   1276 54.07279       10</span></span></code></pre></div>
<p>Note that each column stores the values for each variable. Let’s
predict our Maxnet models to this <code>data.frame</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_selected.html">predict_selected</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, </span>
<span>                         new_variables <span class="op">=</span> <span class="va">var_df</span>, <span class="co">#Now, a data.frame</span></span>
<span>                         progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span></code></pre></div>
<p>Now, instead of <code>SpatRaster</code> objects, the function returns
<code>data.frame</code> objects with the predictions:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Results by replicate of the model 192</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p_df</span><span class="op">$</span><span class="va">Model_192</span><span class="op">$</span><span class="va">Replicates</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Partition_1  Partition_2  Partition_3  Partition_4   Full_model</span></span>
<span><span class="co">#&gt; 1 0.006521501 0.0006209852 0.0005883615 9.831561e-05 9.526648e-08</span></span>
<span><span class="co">#&gt; 2 0.006446437 0.0005356316 0.0005713501 9.009486e-05 8.993584e-08</span></span>
<span><span class="co">#&gt; 3 0.006233583 0.0003396879 0.0004975279 6.967025e-05 8.559934e-08</span></span>
<span><span class="co">#&gt; 4 0.005797668 0.0001458500 0.0003605775 4.303576e-05 8.306910e-08</span></span>
<span><span class="co">#&gt; 5 0.008513515 0.0002034105 0.0006532983 8.529550e-05 4.220225e-07</span></span>
<span><span class="co">#&gt; 6 0.009240381 0.0001753492 0.0006784553 9.035171e-05 6.540127e-07</span></span>
<span></span>
<span><span class="co">#Consensus across replicates of the model 192</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p_df</span><span class="op">$</span><span class="va">Model_192</span><span class="op">$</span><span class="va">Model_consensus</span><span class="op">)</span></span>
<span><span class="co">#&gt;         median       range        mean       stdev</span></span>
<span><span class="co">#&gt; 1 0.0005883615 0.006521406 0.001565852 0.002784420</span></span>
<span><span class="co">#&gt; 2 0.0005356316 0.006446347 0.001528721 0.002761027</span></span>
<span><span class="co">#&gt; 3 0.0003396879 0.006233497 0.001428111 0.002693874</span></span>
<span><span class="co">#&gt; 4 0.0001458500 0.005797585 0.001269443 0.002535186</span></span>
<span><span class="co">#&gt; 5 0.0002034105 0.008513093 0.001891188 0.003710540</span></span>
<span><span class="co">#&gt; 6 0.0001753492 0.009239727 0.002037038 0.004035351</span></span>
<span></span>
<span><span class="co">#General consensus across all models</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p_df</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">)</span></span>
<span><span class="co">#&gt;         median       range        mean       stdev</span></span>
<span><span class="co">#&gt; 1 0.0005892047 0.006521444 0.001506370 0.002502583</span></span>
<span><span class="co">#&gt; 2 0.0005348599 0.006446378 0.001477821 0.002497636</span></span>
<span><span class="co">#&gt; 3 0.0003390597 0.006233519 0.001390363 0.002461362</span></span>
<span><span class="co">#&gt; 4 0.0001459093 0.005797595 0.001250202 0.002350678</span></span>
<span><span class="co">#&gt; 5 0.0002032855 0.008513101 0.001870336 0.003456477</span></span>
<span><span class="co">#&gt; 6 0.0001758720 0.009239727 0.002031620 0.003796839</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level3">
<h3 id="binarize-models">Binarize Models<a class="anchor" aria-label="anchor" href="#binarize-models"></a>
</h3>
<p>The <code>fitted_models</code> object stores the thresholds that can
be used to binarize the models into suitable and unsuitable areas. These
thresholds correspond to the omission error rate used during model
selection (e.g., 5% or 10%).</p>
<p>You can access the omission error rate used to calculate the
thresholds directly from the object:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Get omission error used to select models and calculate the thesholds</span></span>
<span><span class="co">## For maxnet model</span></span>
<span><span class="va">fitted_model_maxnet</span><span class="op">$</span><span class="va">omission_rate</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span></span>
<span><span class="co">## For glm model</span></span>
<span><span class="va">fitted_model_glm</span><span class="op">$</span><span class="va">omission_rate</span></span>
<span><span class="co">#&gt; [1] 10</span></span></code></pre></div>
<p>In both models, a 10% omission error rate was used to calculate the
thresholds. This means that when predictions are binarized,
approximately 10% of the presence records used in model calibration will
fall into areas classified as unsuitable.</p>
<p>The thresholds are summarized in two ways: the mean and median across
replicates for each model, and the consensus mean and median across all
selected models (when more than one model is selected). Let’s check the
thresholds for the general consensus:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#For maxnet</span></span>
<span><span class="va">fitted_model_maxnet</span><span class="op">$</span><span class="va">thresholds</span><span class="op">$</span><span class="va">consensus</span></span>
<span><span class="co">#&gt; $mean</span></span>
<span><span class="co">#&gt; [1] 0.3095083</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $median</span></span>
<span><span class="co">#&gt; [1] 0.259534</span></span>
<span></span>
<span><span class="co">#For glm</span></span>
<span><span class="va">fitted_model_glm</span><span class="op">$</span><span class="va">thresholds</span><span class="op">$</span><span class="va">consensus</span></span>
<span><span class="co">#&gt; $mean</span></span>
<span><span class="co">#&gt; [1] 0.1204713</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $median</span></span>
<span><span class="co">#&gt; [1] 0.1204713</span></span></code></pre></div>
<p>Let’s use these thresholds to binarize the models (this functionality
is only available when predicting to a <code>SpatRaster</code>):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Get the thersholds for models (general consensus)</span></span>
<span><span class="va">thr_mean_maxnet</span> <span class="op">&lt;-</span> <span class="va">fitted_model_maxnet</span><span class="op">$</span><span class="va">thresholds</span><span class="op">$</span><span class="va">consensus</span><span class="op">$</span><span class="va">mean</span> <span class="co">#Maxnet</span></span>
<span><span class="va">thr_mean_glm</span> <span class="op">&lt;-</span> <span class="va">fitted_model_glm</span><span class="op">$</span><span class="va">thresholds</span><span class="op">$</span><span class="va">consensus</span><span class="op">$</span><span class="va">mean</span> <span class="co">#glm</span></span>
<span></span>
<span><span class="co">#Binarize models</span></span>
<span><span class="va">mean_maxnet_bin</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">p_maxnet</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span> <span class="op">&gt;</span> <span class="va">thr_mean_maxnet</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span></span>
<span><span class="va">mean_glm_bin</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">p_glm</span><span class="op">$</span><span class="va">General_consensus</span> <span class="op">&gt;</span> <span class="va">thr_mean_glm</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co">#Compare results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co">#Set grid to plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mean_maxnet_bin</span>, main <span class="op">=</span> <span class="st">"Maxnet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mean_glm_bin</span>, main <span class="op">=</span> <span class="st">"GLM"</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_predictions_files/figure-html/binarize%20models-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#Reinitiate grid</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level3">
<h3 id="clamping-variables">Clamping Variables<a class="anchor" aria-label="anchor" href="#clamping-variables"></a>
</h3>
<p>By default, predictions are performed with free extrapolation
(<code>extrapolation_type = "E"</code>). This can be problematic when
the peak of suitability occurs at the extremes of a predictor’s range.
For example, let’s examine the response curve of the Maxnet model for
<code>bio_7</code> (Temperature Annual Range):</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, variable <span class="op">=</span> <span class="st">"bio_7"</span>, </span>
<span>               extrapolation_factor <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_predictions_files/figure-html/response%20bio_7-1.png" class="r-plt" alt="" width="672"></p>
<p>Note that higher suitability occurs at low values of the temperature
range. However, the lower limit of the calibration data used to fit the
models (dashed line) is at 15.7ºC. The premise that suitability will
increase and stabilize at lower values of <code>bio_7</code> is an
extrapolation of the model (the area to the left of the dashed line).
It’s possible that suitability could begin to decrease at extremely low
values, rendering this extrapolation inaccurate, but the calibration
data is insufficient for the model to predict this.</p>
<p>One way to address this is by clamping the variables. This means that
all values outside the calibration range (both below the lower value and
above the upper value) are set to the respective lower and upper limits
of the calibration range. For example, in the calibration data for the
Maxnet models, the lower and upper limits for <code>bio_7</code> are
15.7ºC and 23.3ºC, respectively:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">fitted_model_maxnet</span><span class="op">$</span><span class="va">calibration_data</span><span class="op">$</span><span class="va">bio_7</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 15.71120 23.30475</span></span></code></pre></div>
<p>To observe the effect of clamping this variable, let’s create a
hypothetical (and extreme) scenario where <code>bio_7</code> has
extremely low values:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#From bio_7, reduce values</span></span>
<span><span class="va">new_bio7</span> <span class="op">&lt;-</span> <span class="va">var</span><span class="op">$</span><span class="va">bio_7</span> <span class="op">-</span> <span class="fl">3</span></span>
<span><span class="co">#Create new scenario</span></span>
<span><span class="va">new_var</span> <span class="op">&lt;-</span> <span class="va">var</span></span>
<span><span class="co">#Replace bio_7 with new_bio7 in this scenario</span></span>
<span><span class="va">new_var</span><span class="op">$</span><span class="va">bio_7</span> <span class="op">&lt;-</span> <span class="va">new_bio7</span></span>
<span></span>
<span><span class="co">#Plot the differences</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var</span><span class="op">$</span><span class="va">bio_7</span>, main <span class="op">=</span> <span class="st">"Original bio_7"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">new_var</span><span class="op">$</span><span class="va">bio_7</span>, main <span class="op">=</span> <span class="st">"New bio_7"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_predictions_files/figure-html/create%20scenario-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#Reinitiate grid</span></span></code></pre></div>
<p>Let’s predict the Maxnet models for this new scenario with both free
extrapolation (<code>extrapolation_type = "E"</code>) and with clamped
variables (<code>extrapolation_type = "EC"</code>):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Predict to hypothetical scenario with free extrapolation</span></span>
<span><span class="va">p_free_extrapolation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_selected.html">predict_selected</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, </span>
<span>                                         new_variables <span class="op">=</span> <span class="va">new_var</span>, <span class="co">#New scenario</span></span>
<span>                                         consensus <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                                         extrapolation_type <span class="op">=</span> <span class="st">"E"</span>, <span class="co">#Free extrapolation (Default)</span></span>
<span>                                         progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Predict to hypothetical scenario with clamping</span></span>
<span><span class="va">p_clamping</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_selected.html">predict_selected</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, </span>
<span>                               new_variables <span class="op">=</span> <span class="va">new_var</span>, <span class="co">#New scenario</span></span>
<span>                               consensus <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                               extrapolation_type <span class="op">=</span> <span class="st">"EC"</span>, <span class="co">#Extrapolation with clamping</span></span>
<span>                               progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Get and see differences</span></span>
<span><span class="va">p_difference</span> <span class="op">&lt;-</span> <span class="va">p_free_extrapolation</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span> <span class="op">-</span> <span class="va">p_clamping</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span></span>
<span></span>
<span><span class="co">#Plot the differences</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_free_extrapolation</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span>, main <span class="op">=</span> <span class="st">"Free extrapolation"</span>,</span>
<span>     zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_clamping</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span>, main <span class="op">=</span> <span class="st">"Clamping"</span>,</span>
<span>     zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_difference</span>, main <span class="op">=</span> <span class="st">"Difference"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">new_bio7</span>, main <span class="op">=</span> <span class="st">"Hypothetical bio_7"</span>, type <span class="op">=</span> <span class="st">"interval"</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_predictions_files/figure-html/unnamed-chunk-3-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#Reinitiate grid</span></span></code></pre></div>
<p>Note that when we clamp the variables, regions with extremely low
values of (the hypothetical) <code>bio_7</code> exhibit lower predicted
suitabilities compared to when free extrapolation is allowed.</p>
<p>By default, when <code>extrapolation_type = "EC"</code> is set, all
predictor variables are clamped. You can specify which variables to
clamp using the <code>var_to_clamp</code> argument.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="no-extrapolation">No Extrapolation<a class="anchor" aria-label="anchor" href="#no-extrapolation"></a>
</h3>
<p>A more rigorous approach is to <strong>predict with no
extrapolation</strong>, where regions outside the limits of the
calibration data are assigned a suitability value of 0. Let’s predict
the Maxnet models using the hypothetical scenario we created in the
previous step to observe the difference:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Predict to hypothetical scenario with no extrapolation</span></span>
<span><span class="va">p_no_extrapolation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_selected.html">predict_selected</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, </span>
<span>                                       new_variables <span class="op">=</span> <span class="va">new_var</span>, <span class="co">#New scenario</span></span>
<span>                                       consensus <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                                       extrapolation_type <span class="op">=</span> <span class="st">"NE"</span>, <span class="co">#No extrapolation</span></span>
<span>                                       progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#Plot the differences</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_free_extrapolation</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span>, main <span class="op">=</span> <span class="st">"Free extrapolation"</span>,</span>
<span>     zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_clamping</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span>, main <span class="op">=</span> <span class="st">"Clamping"</span>,</span>
<span>     zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_no_extrapolation</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span>, main <span class="op">=</span> <span class="st">"No extrapolation"</span>,</span>
<span>     zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">new_bio7</span>, main <span class="op">=</span> <span class="st">"Hypothetical bio_7"</span>, type <span class="op">=</span> <span class="st">"interval"</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_predictions_files/figure-html/no%20extrapolation-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#Reinitiate grid</span></span></code></pre></div>
<p>n this example, a large portion of the predicted area shows zero
suitability. This is because, in this hypothetical scenario, much of the
region has <code>bio_7</code> values lower than those in the calibration
data, which has a minimum of 15ºC. Suitability values greater than zero
are only predicted in areas where <code>bio_7</code> falls within the
range of the calibration data.</p>
<p>By default, when <code>extrapolation_type = "NE"</code> is set, all
predictor variables are considered for this process. You can specify a
subset of variables to be considered for extrapolation using the
<code>var_to_clamp</code> argument.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="output-type">Output Type<a class="anchor" aria-label="anchor" href="#output-type"></a>
</h3>
<p>Maximum entropy models (maxnet) produce four different types of
output for their predictions: raw, cumulative, logistic, and cloglog.
These are described in <a href="https://nsojournals.onlinelibrary.wiley.com/doi/10.1111/j.1600-0587.2013.07872.x" class="external-link">Merow
et al. 2013</a> and <a href="https://nsojournals.onlinelibrary.wiley.com/doi/10.1111/ecog.03049" class="external-link">Phillips
et al. 2017</a>.</p>
<p>All four output types are monotonically related. Therefore,
rank-based metrics for model fit (e.g., omission rate and partial ROC)
will be identical. However, the output types have different scaling,
which leads to distinct interpretations and visually different
prediction maps.</p>
<ul>
<li>
<strong>Raw (or exponential) output</strong> is interpreted as a
Relative Occurrence Rate (ROR). The ROR sums to 1 when predicted to the
calibration data.</li>
<li>
<strong>Cumulative output</strong> assigns to a location the sum of
all raw values less than or equal to the raw value for that location,
and then rescales this to range between 0 and 100. Cumulative output can
be interpreted in terms of an omission rate because thresholding at a
value of <em>c</em> to predict a suitable/unsuitable cell will omit
approximately <em>c</em>% of presences.</li>
<li>
<strong>Cloglog output (Default)</strong> transforms the raw values
into a scale of relative suitability ranging between 0 and 1, using a
logistic transformation based on a user-specified parameter
‘<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>’,
which represents the probability of presence at ‘average’ presence
locations. In this context, the tau value defaults to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>≈</mo><mn>0.632</mn></mrow><annotation encoding="application/x-tex">\tau \approx 0.632</annotation></semantics></math>.</li>
<li>
<strong>Logistic output</strong> is similar to Cloglog, but it
assumes that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\tau = 0.5</annotation></semantics></math>.</li>
</ul>
<p>Let’s examine the differences between these four output types for
Maxnet models:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_cloglog</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_selected.html">predict_selected</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, new_variables <span class="op">=</span> <span class="va">var</span>, </span>
<span>                              type <span class="op">=</span> <span class="st">"cloglog"</span>, progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p_logistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_selected.html">predict_selected</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, new_variables <span class="op">=</span> <span class="va">var</span>, </span>
<span>                              type <span class="op">=</span> <span class="st">"logistic"</span>, progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p_cumulative</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_selected.html">predict_selected</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, new_variables <span class="op">=</span> <span class="va">var</span>, </span>
<span>                              type <span class="op">=</span> <span class="st">"cumulative"</span>, progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_selected.html">predict_selected</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, new_variables <span class="op">=</span> <span class="va">var</span>, </span>
<span>                              type <span class="op">=</span> <span class="st">"raw"</span>, progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Plot the differences</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_cloglog</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span>, main <span class="op">=</span> <span class="st">"Cloglog (Default)"</span>,</span>
<span>     zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_logistic</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span>, main <span class="op">=</span> <span class="st">"Logistic"</span>,</span>
<span>     zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_cumulative</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span>, main <span class="op">=</span> <span class="st">"Cumulative"</span>,</span>
<span>     zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_raw</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span>, main <span class="op">=</span> <span class="st">"Raw"</span>,</span>
<span>     zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_predictions_files/figure-html/output%20types-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#Reinitiate grid</span></span></code></pre></div>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="saving-predictions">Saving Predictions<a class="anchor" aria-label="anchor" href="#saving-predictions"></a>
</h2>
<p>We can save the predictions to the disk by setting
<code>write_files = TRUE</code>. When this option is enabled, you must
provide a directory path in the <code>out_dir</code> argument.</p>
<p>If <code>new_variables</code> is a <code>SpatRaster</code>, the
function will save the output files as GeoTIFF (.tif) files. If
<code>new_variables</code> is a <code>data.frame</code>, the function
will save the output files as Comma Separated Value (.csv) files.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_save</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_selected.html">predict_selected</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, </span>
<span>                           new_variables <span class="op">=</span> <span class="va">var</span>, </span>
<span>                           write_files <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">#To save to the disk</span></span>
<span>                           write_replicates <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">#To save predictions for each replicate</span></span>
<span>                           out_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#A path to save the resuls (here, the temporary directory)</span></span>
<span>                           progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, we can use <code><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster()</a></code> to save specific
output predictions manually. For example, to save only the mean layer
from the general consensus results:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">p_maxnet</span><span class="op">$</span><span class="va">General_consensus</span><span class="op">$</span><span class="va">mean</span>, </span>
<span>            filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Mean_consensus.tif"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Weverton C. F. Trindade, Luis F. Arias-Giraldo, Luis Osorio-Olvera, A. Townsend Peterson, Marlon E. Cobos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
