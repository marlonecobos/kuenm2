<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Occurrence Data Cleaning • kuenm2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Occurrence Data Cleaning">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">kuenm2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.10</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-book"></span> Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic_data_cleaning.html">1. Occurrence Data Cleaning</a></li>
    <li><a class="dropdown-item" href="../articles/prepare_data.html">2. Prepare Data for Model Calibration</a></li>
    <li><a class="dropdown-item" href="../articles/model_calibration.html">3. Model Calibration</a></li>
    <li><a class="dropdown-item" href="../articles/model_exploration.html">4. Fit and Explore Selected Models</a></li>
    <li><a class="dropdown-item" href="../articles/model_predictions.html">5. Predict models to single scenario</a></li>
    <li><a class="dropdown-item" href="../articles/model_projections.html">6. Project models to multiple scenarios</a></li>
    <li><a class="dropdown-item" href="../articles/variability_and_uncertainty.html">7. Exploring Model Uncertainty and Variability</a></li>
    <li><a class="dropdown-item" href="../articles/organize_past_chelsa.html">8. Organize projections manually</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Occurrence Data Cleaning</h1>
            
      

      <div class="d-none name"><code>basic_data_cleaning.Rmd</code></div>
    </div>

    
    
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#getting-ready">Getting ready</a></li>
<li>
<a href="#cleaning-data">Cleaning data</a>
<ul>
<li><a href="#import-data">Import data</a></li>
<li><a href="#basic-cleaning-steps">Basic cleaning steps</a></li>
<li>
<a href="#other-cleaning-steps">Other cleaning steps</a><br>
</li>
</ul>
</li>
<li><a href="#saving-results">Saving results</a></li>
</ul>
<hr>
<div class="section level2">
<h2 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a>
</h2>
<p>As any modeling technique, ecological niche modeling depends on the
quality of the input data, particularly species occurrence records.
Cleaning these data is a critical step to minimize biases, reduce
errors, and ensure meaningful model outcomes. This vignette introduces
tools available in the <strong>kuenm2</strong> package to facilitate the
<em>cleaning of occurrence data</em> prior to modeling. It guides users
through loading and inspecting data, applying cleaning functions, and
saving cleaned datasets, all within a reproducible R workflow.</p>
<p>We want to highlight that additional data cleaning and filtering
steps (e.g., spatial thinning) may be necessary depending on the type of
model or modeling approach the user intends to adopt. The tools
presented here are designed to assist with the most basic steps of
preparing data for modeling.</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="getting-ready">Getting ready<a class="anchor" aria-label="anchor" href="#getting-ready"></a>
</h2>
<p>If <strong>kuenm2</strong> has not been installed yet, please do so.
See the <a href="../index.html">Main guide</a> for installation
instructions.</p>
<p>Load <strong>kuenm2</strong> and any other required packages, and
define a working directory (if needed). In general, setting a working
directory in R is considered good practice, as it provides better
control over where files are read from or saved to. If users are not
working within an R project, we recommend setting a working directory,
since at least one file will be saved at later stages of this guide.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marlonecobos.github.io/kuenm2/">kuenm2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Current directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define new directory</span></span>
<span><span class="co">#setwd("YOUR/DIRECTORY")  # uncomment this line if setting a new directory</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level2">
<h2 id="cleaning-data">Cleaning data<a class="anchor" aria-label="anchor" href="#cleaning-data"></a>
</h2>
<div class="section level3">
<h3 id="import-data">Import data<a class="anchor" aria-label="anchor" href="#import-data"></a>
</h3>
<p>We will use occurrence records provided within the
<strong>kuenm2</strong> package. Most example data sets in the package
were derived from <a href="https://doi.org/10.1111/ddi.13931" class="external-link">Trindade
&amp; Marques (2024)</a>. The <code>occ_data_noclean</code> object
contains 51 valid occurrences of <em>Myrcia hatschbachii</em> (a tree
endemic to Southern Brazil) and a group of erroneous records to
demonstrate cleaning steps.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import occurrences</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">occ_data_noclean</span>, package <span class="op">=</span> <span class="st">"kuenm2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check data structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">occ_data_noclean</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    64 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;  $ species: chr  "Myrcia hatschbachii" "Myrcia hatschbachii" "Myrcia hatschbachii" "Myrcia hatschbachii" ...</span></span>
<span><span class="co">#&gt;  $ x      : num  -51.3 -50.6 -49.3 -49.8 -50.2 ...</span></span>
<span><span class="co">#&gt;  $ y      : num  -29 -27.6 -27.8 -26.9 -28.2 ...</span></span></code></pre></div>
<p><br></p>
<p>A raster layer from a group of layers include in the package will
also be used in this example. This is a bioclimatic variable from <a href="https://worldclim.org/data/bioclim.html" class="external-link">WorldClim 2.1</a> at 10
arc-minute resolution. This layer has been masked using a polygon
generated by drawing a minimum convex polygon around the records with a
300 km buffer.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import raster layers</span></span>
<span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Current_variables.tif"</span>, package <span class="op">=</span> <span class="st">"kuenm2"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Keep only one layer</span></span>
<span><span class="va">var</span> <span class="op">&lt;-</span> <span class="va">var</span><span class="op">$</span><span class="va">bio_1</span></span>
<span></span>
<span><span class="co"># Check variable</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic_data_cleaning_files/figure-html/Load%20variables-1.png" width="672"></p>
<p><br></p>
<p>Visualize occurrences records in geography:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize occurrences on one variable</span></span>
<span><span class="co">## Create an extent based on the layer and the records to see all errors</span></span>
<span><span class="va">vext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span>  <span class="co"># extent of layer</span></span>
<span><span class="va">pext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">occ_data_noclean</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">range</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># extent of records</span></span>
<span></span>
<span><span class="va">allext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">pext</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">vext</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pext</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">vext</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">pext</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">vext</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pext</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">vext</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># plotting records on the variable</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var</span>, ext <span class="op">=</span> <span class="va">allext</span>, main <span class="op">=</span> <span class="st">"Bio 1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">occ_data_noclean</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic_data_cleaning_files/figure-html/visualize-1.png" width="672"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="basic-cleaning-steps">Basic cleaning steps<a class="anchor" aria-label="anchor" href="#basic-cleaning-steps"></a>
</h3>
<p>The basic data cleaning steps implemented in <strong>kuenm2</strong>
help to: remove missing data, eliminate duplicates, exclude typically
(though not always) erroneous coordinates with 0 longitude and 0
latitude, and filter out records with low coordinate precision based on
the number of decimal places.</p>
<p>Below is an example of cleaning missing data. This example uses a
<code>data.frame</code> containing only the columns “Species”, “x”, and
“y” (where “x” and “y” represent longitude and latitude, respectively).
If the <code>data.frame</code> includes additional columns and not all
of them should be considered when identifying missing values, users can
specify which columns to use via the <code>columns</code> argument
(default = <code>NULL</code>, which includes all columns). As with any
function, we recommend consulting the documentation for more detailed
explanations (e.g., <code><a href="../reference/initial_cleaning.html">help(remove_missing)</a></code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remove missing data</span></span>
<span><span class="va">mis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initial_cleaning.html">remove_missing</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">occ_data_noclean</span>, columns <span class="op">=</span> <span class="cn">NULL</span>, remove_na <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                      remove_empty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># quick check</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occ_data_noclean</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 64</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mis</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 60</span></span></code></pre></div>
<p><br></p>
<p>The code below uses the previous results and continues the process of
cleaning data by removing duplicates. The argument <code>columns</code>
can be used as explained before. See full documentation with
<code><a href="../reference/initial_cleaning.html">help(remove_duplicates)</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remove exact duplicates</span></span>
<span><span class="va">mis_dup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initial_cleaning.html">remove_duplicates</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mis</span>, columns <span class="op">=</span> <span class="cn">NULL</span>, keep_all_columns <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># quick check</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mis</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 60</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mis_dup</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 57</span></span></code></pre></div>
<p><br></p>
<p>Continue the process by removing coordinates with values of 0 (zero)
for longitude and latitude (not always needed, as this location is valid
if working with some marine species). See full documentation with
<code><a href="../reference/initial_cleaning.html">help(remove_corrdinates_00)</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remove records with 0 for x and y coordinates</span></span>
<span><span class="va">mis_dup_00</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initial_cleaning.html">remove_corrdinates_00</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mis_dup</span>, x <span class="op">=</span> <span class="st">"x"</span>, y <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># quick check</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mis_dup</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 57</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mis_dup_00</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 56</span></span></code></pre></div>
<p><br></p>
<p>The following lines of code take the previous result and remove
coordinates with low precision. If the longitude and latitude contain no
or only a few decimal places, they may have been rounded, which can be
problematic in some areas. This a step recommended when users know
coordinate rounding is an issue. This filtering process can also be
applied to longitude and latitude independently. See full documentation
with <code><a href="../reference/initial_cleaning.html">help(filter_decimal_precision)</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remove coordinates with low decimal precision.</span></span>
<span><span class="va">mis_dup_00_dec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initial_cleaning.html">filter_decimal_precision</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mis_dup_00</span>, x <span class="op">=</span> <span class="st">"x"</span>, y <span class="op">=</span> <span class="st">"y"</span>, </span>
<span>                                           decimal_precision <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># quick check</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mis_dup_00</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 56</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mis_dup_00_dec</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 51</span></span></code></pre></div>
<p><br></p>
<p>Users can perform all this steps with a single function as
follows:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># all basinc cleaning steps</span></span>
<span><span class="va">clean_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initial_cleaning.html">initial_cleaning</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">occ_data_noclean</span>, species <span class="op">=</span> <span class="st">"species"</span>, </span>
<span>                               x <span class="op">=</span> <span class="st">"x"</span>, y <span class="op">=</span> <span class="st">"y"</span>, remove_na <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                               remove_empty <span class="op">=</span> <span class="cn">TRUE</span>, remove_duplicates <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                               by_decimal_precision <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                               decimal_precision <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># quick check</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occ_data_noclean</span><span class="op">)</span>  <span class="co"># original data</span></span>
<span><span class="co">#&gt; [1] 64</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">clean_init</span><span class="op">)</span>  <span class="co"># data after all basic cleaning steps</span></span>
<span><span class="co">#&gt; [1] 51</span></span>
<span></span>
<span><span class="co"># a final plot to check</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## initial data</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var</span>, ext <span class="op">=</span> <span class="va">allext</span>, main <span class="op">=</span> <span class="st">"Initial data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">occ_data_noclean</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## data after basic cleaning steps</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var</span>, ext <span class="op">=</span> <span class="va">allext</span>, main <span class="op">=</span> <span class="st">"After basic cleaning"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">clean_init</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var</span>, main <span class="op">=</span> <span class="st">"After basic cleaning (zoom)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">clean_init</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic_data_cleaning_files/figure-html/all%20basic-1.png" width="672"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="other-cleaning-steps">Other cleaning steps<a class="anchor" aria-label="anchor" href="#other-cleaning-steps"></a>
</h3>
<p>Two additional cleaning steps are implemented in
<strong>kuenm2</strong>, removing cell duplicates and moving points to
valid cells.</p>
<p>Removing cell duplicates involves excluding records that are not
exact coordinate duplicates but are located within the same pixel. The
process randomly selects one record from each cell to retain. See full
documentation with <code><a href="../reference/advanced_cleaning.html">help(remove_cell_duplicates)</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># exclude duplicates based on raster cell (pixel)</span></span>
<span><span class="va">celldup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/advanced_cleaning.html">remove_cell_duplicates</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">clean_init</span>, x <span class="op">=</span> <span class="st">"x"</span>, y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>                                  raster_layer <span class="op">=</span> <span class="va">var</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># quick check</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">clean_init</span><span class="op">)</span>  <span class="co"># data after all basic cleaning steps</span></span>
<span><span class="co">#&gt; [1] 51</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">celldup</span><span class="op">)</span>  <span class="co"># plus removing cell duplicates</span></span>
<span><span class="co">#&gt; [1] 42</span></span></code></pre></div>
<p><br></p>
<p>The following lines of code help adjust records that fall just
outside valid raster cells to prevent data loss. Given the nature and
resolution of raster layers, valid records are sometimes perceived as
being outside the boundaries of cells with data. In such cases, an
alternative is to move these records to the nearest valid cell. A
distance limit is applied to avoid relocating records that are too far
from the study area. See below for an example of how to use this
approach. See full documentation with
<code><a href="../reference/advanced_cleaning.html">help(move_2closest_cell)</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># move records to valid pixels</span></span>
<span><span class="va">moved</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/advanced_cleaning.html">move_2closest_cell</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">celldup</span>, x <span class="op">=</span> <span class="st">"x"</span>, y <span class="op">=</span> <span class="st">"y"</span>, </span>
<span>                            raster_layer <span class="op">=</span> <span class="va">var</span>, move_limit_distance <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Moving occurrences to closest pixels...</span></span>
<span></span>
<span><span class="co"># quick check</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">celldup</span><span class="op">)</span>  <span class="co"># basic cleaning and no cell duplicates</span></span>
<span><span class="co">#&gt; [1] 42</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">moved</span><span class="op">[</span><span class="va">moved</span><span class="op">$</span><span class="va">condition</span> <span class="op">!=</span> <span class="st">"Not_moved"</span>, <span class="op">]</span><span class="op">)</span>  <span class="co"># plus moved to valid cells</span></span>
<span><span class="co">#&gt; [1] 41</span></span></code></pre></div>
<p><br></p>
<p>The function <em>advanced_cleaning</em> facilitates the two processes
from above in a single step:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># move records to valid pixels</span></span>
<span><span class="va">clean_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/advanced_cleaning.html">advanced_cleaning</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">clean_init</span>, x <span class="op">=</span> <span class="st">"x"</span>, y <span class="op">=</span> <span class="st">"y"</span>, </span>
<span>                                raster_layer <span class="op">=</span> <span class="va">var</span>, cell_duplicates <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                move_points_inside <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                move_limit_distance <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Moving occurrences to closest pixels...</span></span>
<span></span>
<span><span class="co"># exclude points not moved</span></span>
<span><span class="va">clean_data</span> <span class="op">&lt;-</span> <span class="va">clean_data</span><span class="op">[</span><span class="va">clean_data</span><span class="op">$</span><span class="va">condition</span> <span class="op">!=</span> <span class="st">"Not_moved"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># quick check</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occ_data_noclean</span><span class="op">)</span>  <span class="co"># original data</span></span>
<span><span class="co">#&gt; [1] 64</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">clean_init</span><span class="op">)</span>  <span class="co"># data after all basic cleaning steps</span></span>
<span><span class="co">#&gt; [1] 51</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">clean_data</span><span class="op">)</span>  <span class="co"># data after all basic cleaning steps</span></span>
<span><span class="co">#&gt; [1] 41</span></span>
<span></span>
<span><span class="co"># a final plot to check</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## initial data</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var</span>, ext <span class="op">=</span> <span class="va">allext</span>, main <span class="op">=</span> <span class="st">"Initial"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">occ_data_noclean</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## data after basic cleaning steps</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var</span>, ext <span class="op">=</span> <span class="va">allext</span>, main <span class="op">=</span> <span class="st">"Basic cleaning"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">clean_init</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var</span>, main <span class="op">=</span> <span class="st">"Basic cleaning (zoom)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">clean_init</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## data after basic cleaning steps</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var</span>, main <span class="op">=</span> <span class="st">"Final data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">clean_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## zoom to a particular area, initial data</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">48</span>, <span class="op">-</span><span class="fl">50</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">26</span>, <span class="op">-</span><span class="fl">25</span><span class="op">)</span>,  main <span class="op">=</span> <span class="st">"Initial (zoom +)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">occ_data_noclean</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## zoom to a particular area, final data</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">48</span>, <span class="op">-</span><span class="fl">50</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">26</span>, <span class="op">-</span><span class="fl">25</span><span class="op">)</span>,  main <span class="op">=</span> <span class="st">"Final (zoom +)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">clean_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic_data_cleaning_files/figure-html/all%20advanced-1.png" width="672"></p>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="saving-results">Saving results<a class="anchor" aria-label="anchor" href="#saving-results"></a>
</h2>
<p>The results of the data cleaning steps in <strong>kuenm2</strong> are
simple <code>data.frames</code> that may include a few additional
columns and fewer records than the original dataset. An easy way to save
these results is by writing them to CSV files. Although multiple options
exist for saving this type of data, another useful alternative is to
save it as an RDS file in your directory. See the examples below:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save as CSV</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">clean_data</span>, file <span class="op">=</span> <span class="st">"Clean_data.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save as RDS</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">clean_data</span>, file <span class="op">=</span> <span class="st">"Clean_data.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marlon E. Cobos, Weverton Trindade, Luis F. Arias-Giraldo, Luis Osorio-Olvera, A. Townsend Peterson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
