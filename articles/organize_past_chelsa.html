<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Organize projections manually: An example with LGM from CHELSA • kuenm2</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Organize projections manually: An example with LGM from CHELSA">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">kuenm2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.10</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-book"></span> Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic_data_cleaning.html">1. Occurrence Data Cleaning</a></li>
    <li><a class="dropdown-item" href="../articles/prepare_data.html">2. Prepare Data for Model Calibration</a></li>
    <li><a class="dropdown-item" href="../articles/model_calibration.html">3. Model Calibration</a></li>
    <li><a class="dropdown-item" href="../articles/model_exploration.html">4. Fit and Explore Selected Models</a></li>
    <li><a class="dropdown-item" href="../articles/model_predictions.html">5. Predict models to single scenario</a></li>
    <li><a class="dropdown-item" href="../articles/model_projections.html">6. Project models to multiple scenarios</a></li>
    <li><a class="dropdown-item" href="../articles/variability_and_uncertainty.html">7. Exploring Model Uncertainty and Variability</a></li>
    <li><a class="dropdown-item" href="../articles/organize_past_chelsa.html">8. Organize projections manually</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/marlonecobos/kuenm2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Organize projections manually: An example with LGM from CHELSA</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/marlonecobos/kuenm2/blob/main/vignettes/organize_past_chelsa.Rmd" class="external-link"><code>vignettes/organize_past_chelsa.Rmd</code></a></small>
      <div class="d-none name"><code>organize_past_chelsa.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marlonecobos.github.io/kuenm2/">kuenm2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.60</span></span></code></pre></div>
<p>In the <a href="model_projections.html">“Project models to multiple
scenarios”</a> vignette, we show how to predict the models to multiple
scenarios at once. We used as example the future scenarios available in
<a href="https://worldclim.org/data/cmip6/cmip6climate.html" class="external-link">WorldClim</a>,
which have an specific function (<code>organize_future_worldclim</code>)
to organize the files in the specific hierarchical manner compatible
with <code>kuenm2</code>.</p>
<p>Specifically, we need a root directory containing nested folders
representing different scenarios, with the raster variables stored
within. At the first level inside the root folder, subfolders should
correspond to distinct time periods (e.g., future years like “2070” or
“2100,” or past periods such as “Mid-holocene” or “LGM”). Within each
period folder, if applicable, you should include subfolders for each
emission scenario (e.g., “ssp126”, “ssp585”). Finally, within each
emission scenario or time period folder, you need to include a separate
folder for each General Circulation Model (GCM) (e.g., “BCC-CSM2-MR”,
“MIROC6”)</p>
<p>Here, we will show how to organize the files manually, making
possible to project the models using scenarios available in different
sources. As example, we will use the variables from CHELSA representing
<a href="https://chelsa-climate.org/last-glacial-maximum-climate/" class="external-link">scenarios
of the Last Glacial Maximum</a> (LGM, 21,000 year ago).</p>
</div>
<div class="section level2">
<h2 id="standardize-raster-file-names-for-model-projections">Standardize Raster File Names for Model Projections<a class="anchor" aria-label="anchor" href="#standardize-raster-file-names-for-model-projections"></a>
</h2>
<p>Before using the organize_for_projection() function, the climate
variables must first be saved as separate .tif files — one file per
scenario. Filenames should follow a consistent pattern that clearly
indicates the time period, GCM, and, for future scenarios, the emission
scenario (SSP). For example:</p>
<p>A file representing past conditions for the “LGM” period using the
“MIROC6” GCM should be named: “Past_LGM_MIROC6.tif”</p>
<p>A file representing future conditions for the period “2081–2100”
under the emission scenario “ssp585” and the GCM “ACCESS-CM2” should be
named: “Future_2081-2100_ssp585_ACCESS-CM2.tif”</p>
<p>All scenario files must contain the same variable names (e.g., bio1,
bio2, etc.) and units as those used during model calibration.</p>
<p>Let’s see how to achieve this in practice.</p>
</div>
<div class="section level2">
<h2 id="getting-variables-from-chelsa">Getting variables from CHELSA<a class="anchor" aria-label="anchor" href="#getting-variables-from-chelsa"></a>
</h2>
<div class="section level3">
<h3 id="download-variables-from-lgm">Download variables from LGM<a class="anchor" aria-label="anchor" href="#download-variables-from-lgm"></a>
</h3>
<p>The first step is downloading the variables representing LGM
condition from CHELSA. You can download the files directly from <a href="https://chelsa-climate.org/last-glacial-maximum-climate/" class="external-link">this
link</a>, or follow the script below. We need to specify a folder to
save the variables, the General Circulation Models (GCMs) and the
variables:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define variables to download</span></span>
<span><span class="va">var_to_use</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BIO_01"</span>, <span class="st">"BIO_07"</span>, <span class="st">"BIO_12"</span>, <span class="st">"BIO_15"</span><span class="op">)</span></span>
<span><span class="co"># Define GCMs</span></span>
<span><span class="va">gcms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CCSM4"</span>, <span class="st">"CNRM-CM5"</span>, <span class="st">"FGOALS-g2"</span>, <span class="st">"IPSL-CM5A-LR"</span>, <span class="st">"MIROC-ESM"</span>,</span>
<span>          <span class="st">"MPI-ESM-P"</span>, <span class="st">"MRI-CGCM3"</span><span class="op">)</span></span>
<span><span class="co"># Create a grid combining variables and GCMs</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="st">"gcm"</span> <span class="op">=</span> <span class="va">gcms</span>, <span class="st">"var"</span> <span class="op">=</span> <span class="va">var_to_use</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create links to download</span></span>
<span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">gcm_i</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">$</span><span class="va">gcm</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">var_i</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">$</span><span class="va">var</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="co">#Create link to download</span></span>
<span>  <span class="va">l_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://os.zhdk.cloud.switch.ch/chelsav1/pmip3/bioclim/CHELSA_PMIP_"</span>,</span>
<span>                <span class="va">gcm_i</span>, <span class="st">"_"</span>, <span class="va">var_i</span>, <span class="st">".tif"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># See links</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "https://os.zhdk.cloud.switch.ch/chelsav1/pmip3/bioclim/CHELSA_PMIP_CCSM4_BIO_01.tif"       </span></span>
<span><span class="co">#&gt; [2] "https://os.zhdk.cloud.switch.ch/chelsav1/pmip3/bioclim/CHELSA_PMIP_CNRM-CM5_BIO_01.tif"    </span></span>
<span><span class="co">#&gt; [3] "https://os.zhdk.cloud.switch.ch/chelsav1/pmip3/bioclim/CHELSA_PMIP_FGOALS-g2_BIO_01.tif"   </span></span>
<span><span class="co">#&gt; [4] "https://os.zhdk.cloud.switch.ch/chelsav1/pmip3/bioclim/CHELSA_PMIP_IPSL-CM5A-LR_BIO_01.tif"</span></span>
<span><span class="co">#&gt; [5] "https://os.zhdk.cloud.switch.ch/chelsav1/pmip3/bioclim/CHELSA_PMIP_MIROC-ESM_BIO_01.tif"   </span></span>
<span><span class="co">#&gt; [6] "https://os.zhdk.cloud.switch.ch/chelsav1/pmip3/bioclim/CHELSA_PMIP_MPI-ESM-P_BIO_01.tif"</span></span>
<span></span>
<span><span class="co"># Create a directory to save the raw variables</span></span>
<span><span class="va">raw_past_chelsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Raw_past"</span><span class="op">)</span> <span class="co">#Here, in a temporary directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">raw_past_chelsa</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download files and save in the Raw_past directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>timeout <span class="op">=</span> <span class="fl">300</span><span class="op">)</span> <span class="co">#For avoiding errors with timeout</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">l</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#Donwload only if the file has not been downloaded yet</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">raw_past_chelsa</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">i</span>,</span>
<span>                destfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">raw_past_chelsa</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                method <span class="op">=</span> <span class="st">"curl"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="co">#It will take a while</span></span>
<span></span>
<span><span class="co">#Check the files in the Raw_past</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">raw_past_chelsa</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CHELSA_PMIP_CCSM4_BIO_01.tif"        "CHELSA_PMIP_CCSM4_BIO_07.tif"</span></span>
<span><span class="co">#&gt; [3] "CHELSA_PMIP_CCSM4_BIO_12.tif"        "CHELSA_PMIP_CCSM4_BIO_15.tif"</span></span>
<span><span class="co">#&gt; [5] "CHELSA_PMIP_CNRM-CM5_BIO_01.tif"     "CHELSA_PMIP_CNRM-CM5_BIO_07.tif"</span></span>
<span><span class="co">#&gt; [7] "CHELSA_PMIP_CNRM-CM5_BIO_12.tif"     "CHELSA_PMIP_CNRM-CM5_BIO_15.tif"</span></span>
<span><span class="co">#&gt; [9] "CHELSA_PMIP_FGOALS-g2_BIO_01.tif"    "CHELSA_PMIP_FGOALS-g2_BIO_07.tif"</span></span>
<span><span class="co">#&gt; [11] "CHELSA_PMIP_FGOALS-g2_BIO_12.tif"    "CHELSA_PMIP_FGOALS-g2_BIO_15.tif"</span></span>
<span><span class="co">#&gt; [13] "CHELSA_PMIP_IPSL-CM5A-LR_BIO_01.tif" "CHELSA_PMIP_IPSL-CM5A-LR_BIO_07.tif"</span></span>
<span><span class="co">#&gt; [15] "CHELSA_PMIP_IPSL-CM5A-LR_BIO_12.tif" "CHELSA_PMIP_IPSL-CM5A-LR_BIO_15.tif"</span></span>
<span><span class="co">#&gt; [17] "CHELSA_PMIP_MIROC-ESM_BIO_01.tif"    "CHELSA_PMIP_MIROC-ESM_BIO_07.tif"</span></span>
<span><span class="co">#&gt; [19] "CHELSA_PMIP_MIROC-ESM_BIO_12.tif"    "CHELSA_PMIP_MIROC-ESM_BIO_15.tif"</span></span>
<span><span class="co">#&gt; [21] "CHELSA_PMIP_MPI-ESM-P_BIO_01.tif"    "CHELSA_PMIP_MPI-ESM-P_BIO_07.tif"</span></span>
<span><span class="co">#&gt; [23] "CHELSA_PMIP_MPI-ESM-P_BIO_12.tif"    "CHELSA_PMIP_MPI-ESM-P_BIO_15.tif"</span></span>
<span><span class="co">#&gt; [25] "CHELSA_PMIP_MRI-CGCM3_BIO_01.tif"    "CHELSA_PMIP_MRI-CGCM3_BIO_07.tif"</span></span>
<span><span class="co">#&gt; [27] "CHELSA_PMIP_MRI-CGCM3_BIO_12.tif"    "CHELSA_PMIP_MRI-CGCM3_BIO_15.tif"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-variables-from-current-period">Download variables from Current Period<a class="anchor" aria-label="anchor" href="#download-variables-from-current-period"></a>
</h3>
<p>We also need the variables representing current conditions
(1981-2010) from CHELSA. You can download the files directly from <a href="https://chelsa-climate.org/downloads/" class="external-link">this link</a>, or follow
the script below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Create directory to save tha variables</span></span>
<span><span class="va">present_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Present_raw"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">present_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Define variables to download</span></span>
<span><span class="va">var_present</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio1"</span>, <span class="st">"bio7"</span>, <span class="st">"bio12"</span>, <span class="st">"bio15"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Create links, download and save in the Present_raw directory</span></span>
<span><span class="va">l_present</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">var_present</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#Create link to download</span></span>
<span>  <span class="va">l_present_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://os.zhdk.cloud.switch.ch/chelsav2/GLOBAL/climatologies/1981-2010/bio/CHELSA_"</span>, <span class="va">i</span>, <span class="st">"_1981-2010_V.2.1.tif"</span><span class="op">)</span></span>
<span>  <span class="co">#Donwload only if the file has not been downloaded yet</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">present_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">l_present_i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">l_present_i</span>,</span>
<span>                destfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">present_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">l_present_i</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                method <span class="op">=</span> <span class="st">"curl"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="co">#It will take a while</span></span>
<span></span>
<span><span class="co">#Check the files in the directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">present_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CHELSA_bio1_1981-2010_V.2.1.tif"     "CHELSA_bio12_1981-2010_V.2.1.tif"</span></span>
<span><span class="co">#&gt; [3] "CHELSA_bio15_1981-2010_V.2.1.tif"    "CHELSA_bio7_1981-2010_V.2.1.tif"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="merge-and-rename-variables-from-the-same-scenario">Merge and Rename Variables from the Same Scenario<a class="anchor" aria-label="anchor" href="#merge-and-rename-variables-from-the-same-scenario"></a>
</h3>
<p>After downloading the files, we need to merge the variables in a
single <code>SpatRaster</code> for each scenario. In general, past
scenarios differs only in terms of GCM, while future scenarios are
characterized by different emission scenarios (i.e., SSP1-26 and
SSP5-85) and GCMs.</p>
<p>First, let’s merge the variables from the present scenarios. To speed
up the analysis in this example, we will also resample the rasters from
30 arc-seconds to 10 arc-minutes, and crop the variables using a
calibration area (M), which is provided as example in the package and it
was defined by drawing a minimum convex polygons around the species’
occurrences and added a buffer of 300km.</p>
<p>We will also rename the variables to the pattern “bio1”, “bio12”,
“bio15”, and “bio7”.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Load package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import M</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"m.gpkg"</span>, </span>
<span>                        package <span class="op">=</span> <span class="st">"kuenm2"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import present variables</span></span>
<span><span class="va">present_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">present_dir</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">#List files</span></span>
<span><span class="va">present_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">present_files</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Mask variables using the calibration area (m)</span></span>
<span><span class="va">present_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">present_var</span>, <span class="va">m</span>, mask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check variables names</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">present_m</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CHELSA_bio1_1981-2010_V.2.1"  "CHELSA_bio12_1981-2010_V.2.1"</span></span>
<span><span class="co">#&gt; [3] "CHELSA_bio15_1981-2010_V.2.1" "CHELSA_bio7_1981-2010_V.2.1"</span></span>
<span></span>
<span><span class="co"># Rename variables</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">present_m</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio1"</span>, <span class="st">"bio12"</span>, <span class="st">"bio15"</span>, <span class="st">"bio7"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">present_m</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "bio1"  "bio12" "bio15" "bio7"</span></span>
<span></span>
<span><span class="co"># Check current resolution (30arc-sec)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">present_m</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.008333333 0.008333333</span></span>
<span></span>
<span><span class="co">#Decrease resolution to 10arc-min</span></span>
<span><span class="va">present_chelsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">present_m</span>, fact <span class="op">=</span> <span class="fl">20</span>, fun <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Save processed raster</span></span>
<span><span class="va">dir_current</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Current_CHELSA"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">dir_current</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">present_chelsa</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_current</span>, <span class="st">"Current_CHELSA.tif"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s do the same thing with variables representing LGM
conditions, starting by masking the variables using the <code>m</code>
and resampling to 10arc-min:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import LGM variables</span></span>
<span><span class="va">lgm_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">raw_past_chelsa</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">#List files</span></span>
<span><span class="va">lgm_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">lgm_files</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Mask variables using the calibration area (m)</span></span>
<span><span class="va">lgm_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">lgm_var</span>, <span class="va">m</span>, mask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Decrease resolution to 10arc-min</span></span>
<span><span class="va">lgm_chelsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">lgm_m</span>, fact <span class="op">=</span> <span class="fl">20</span>, fun <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Check variables names</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lgm_chelsa</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "CHELSA_PMIP_CCSM4_BIO_01"        "CHELSA_PMIP_CCSM4_BIO_07"       </span></span>
<span><span class="co">#&gt;  [3] "CHELSA_PMIP_CCSM4_BIO_12"        "CHELSA_PMIP_CCSM4_BIO_15"       </span></span>
<span><span class="co">#&gt;  [5] "CHELSA_PMIP_CNRM-CM5_BIO_01"     "CHELSA_PMIP_CNRM-CM5_BIO_07"    </span></span>
<span><span class="co">#&gt;  [7] "CHELSA_PMIP_CNRM-CM5_BIO_12"     "CHELSA_PMIP_CNRM-CM5_BIO_15"    </span></span>
<span><span class="co">#&gt;  [9] "CHELSA_PMIP_FGOALS-g2_BIO_01"    "CHELSA_PMIP_FGOALS-g2_BIO_07"   </span></span>
<span><span class="co">#&gt; [11] "CHELSA_PMIP_FGOALS-g2_BIO_12"    "CHELSA_PMIP_FGOALS-g2_BIO_15"   </span></span>
<span><span class="co">#&gt; [13] "CHELSA_PMIP_IPSL-CM5A-LR_BIO_01" "CHELSA_PMIP_IPSL-CM5A-LR_BIO_07"</span></span>
<span><span class="co">#&gt; [15] "CHELSA_PMIP_IPSL-CM5A-LR_BIO_12" "CHELSA_PMIP_IPSL-CM5A-LR_BIO_15"</span></span>
<span><span class="co">#&gt; [17] "CHELSA_PMIP_MIROC-ESM_BIO_01"    "CHELSA_PMIP_MIROC-ESM_BIO_07"   </span></span>
<span><span class="co">#&gt; [19] "CHELSA_PMIP_MIROC-ESM_BIO_12"    "CHELSA_PMIP_MIROC-ESM_BIO_15"   </span></span>
<span><span class="co">#&gt; [21] "CHELSA_PMIP_MPI-ESM-P_BIO_01"    "CHELSA_PMIP_MPI-ESM-P_BIO_07"   </span></span>
<span><span class="co">#&gt; [23] "CHELSA_PMIP_MPI-ESM-P_BIO_12"    "CHELSA_PMIP_MPI-ESM-P_BIO_15"   </span></span>
<span><span class="co">#&gt; [25] "CHELSA_PMIP_MRI-CGCM3_BIO_01"    "CHELSA_PMIP_MRI-CGCM3_BIO_07"   </span></span>
<span><span class="co">#&gt; [27] "CHELSA_PMIP_MRI-CGCM3_BIO_12"    "CHELSA_PMIP_MRI-CGCM3_BIO_15"</span></span></code></pre></div>
<p>Note that the variables names contains the same <code>gcms</code> we
used to download. The trick here is using these patterns for grouping
the variables:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In each iteration, 'i' is a GCM</span></span>
<span><span class="va">lgm_by_gcm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">gcms</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#Subset variables that belong to GCM i</span></span>
<span>  <span class="va">lgm_gcm_i</span> <span class="op">&lt;-</span> <span class="va">lgm_chelsa</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="va">i</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lgm_chelsa</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="co">#Rename variables</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lgm_gcm_i</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio1"</span>, <span class="st">"bio7"</span>, <span class="st">"bio12"</span>, <span class="st">"bio15"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">lgm_gcm_i</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lgm_by_gcm</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">gcms</span></span></code></pre></div>
<p>One important thing to note is that the <a href="https://chelsa-climate.org/wp-admin/download-page/CHELSA_tech_specification.pdf#page=38.00" class="external-link">Technical
Specifications of CHELSA</a> specifies that the variables from LGM have
different units than the current ones. In the current time, bio_1 have
values in ºC, while in the LGM it has values in K * 10. bio_7 have
values in ºC in the current time and in ºC * 10 in LGM. The current
precipitation variables are in milimeters (mm) or percentage of
variation (bio_15), while in the LGM they are in mm * 10 or % * 10.
<strong>Yes, it’s a mess</strong>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check units of variables in present</span></span>
<span><span class="co">#&gt; minmax(present_chelsa[[c("bio1", "bio7", "bio12", "bio15")]])</span></span>
<span><span class="co">#&gt;         bio1     bio7    bio12    bio15</span></span>
<span><span class="co">#&gt; min 12.87700 10.11300 1211.605 10.32925</span></span>
<span><span class="co">#&gt; max 24.70025 21.06125 3063.049 70.45125</span></span>
<span></span>
<span><span class="co"># Check units of variables in LGM (CCSM4)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">lgm_by_gcm</span><span class="op">$</span><span class="va">CCSM4</span><span class="op">)</span></span>
<span><span class="co">#&gt;         bio1     bio7    bio12    bio15</span></span>
<span><span class="co">#&gt; min 2822.425 173.5125 10710.62  86.9125</span></span>
<span><span class="co">#&gt; max 2946.758 219.7700 23159.20 659.0025</span></span></code></pre></div>
<p>We need to convert these variables to they have the same units as the
current variables:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lgm_fixed_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lgm_by_gcm</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">$</span><span class="va">bio1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">bio1</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span> <span class="op">-</span> <span class="fl">273</span> <span class="co">#Divide by 10 and subtracts -273 to convert to ºC</span></span>
<span>  <span class="va">x</span><span class="op">$</span><span class="va">bio7</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">bio7</span><span class="op">/</span><span class="fl">10</span> <span class="co">#Divide by 10</span></span>
<span>  <span class="va">x</span><span class="op">$</span><span class="va">bio12</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">bio12</span><span class="op">/</span><span class="fl">10</span> <span class="co">#Divide by 10</span></span>
<span>  <span class="va">x</span><span class="op">$</span><span class="va">bio15</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">bio15</span><span class="op">/</span><span class="fl">10</span> <span class="co">#Divide by 10</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Check units</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">lgm_fixed_units</span><span class="op">$</span><span class="va">CCSM4</span><span class="op">)</span></span>
<span><span class="co">#&gt;         bio1     bio7    bio12    bio15</span></span>
<span><span class="co">#&gt; min  9.24250 17.35125 1071.062  8.69125</span></span>
<span><span class="co">#&gt; max 21.67575 21.97700 2315.920 65.90025</span></span></code></pre></div>
<p>Now that we have the variables in LGM grouped by scenarios (GCMs),
with the same names and same units as in the current variables, we can
write the raster to disk. Remember that the filenames must have the time
period (LGM) and the GCM of each scenario (for variables representing
future scenarios, it also must have the SSPs for emission
scenarios):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create directory to save processed lgm variables</span></span>
<span><span class="va">dir_lgm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"LGM_CHELSA"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">dir_lgm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In each iteration, i is one of the GCMs </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lgm_fixed_units</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#Subset spatraster from GCM i</span></span>
<span>  <span class="va">r_i</span> <span class="op">&lt;-</span> <span class="va">lgm_fixed_units</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="co">#Name the file with the Period (LGM) and GCM (i)</span></span>
<span>  <span class="va">filename_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"CHELSA_LGM_"</span>, <span class="va">i</span>, <span class="st">".tif"</span><span class="op">)</span> </span>
<span>  <span class="co">#Write Raster</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">r_i</span>, </span>
<span>              filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_lgm</span>, <span class="va">filename_i</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="organize-and-structure-variables">Organize and structure variables<a class="anchor" aria-label="anchor" href="#organize-and-structure-variables"></a>
</h2>
<p>At this points you must have:</p>
<ul>
<li>The variables stored as TIF files, one file per scenario.</li>
<li>The names of the raster variables containing patterns to identify
the time periods, GCMS and SSPs (in case of future scenarios).</li>
<li>The variables names (bio1, bio2, etc) of the scenarios with the same
names and units as in the current variables used to calibrate the
model.</li>
</ul>
<p>Now, we can use the function <code><a href="../reference/organize_for_projection.html">organize_for_projection()</a></code>
to organize the files in the specific hierarchical manner compatible
with <code>kuenm2</code>. The function requires:</p>
<ul>
<li>
<code>present_file</code>, <code>past_files</code> or
<code>future_files</code>: character vectors with the <strong>full
path</strong> to the variables from the scenarios of interest (present,
past or future, respectively). When listing these files, is important to
set <code>full.names = TRUE</code> in <code><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files()</a></code>.</li>
<li>
<code>past_period</code> and/or <code>future_period</code>:
character vectors specifing the time periods in past and future,
respectively. Examples of past periods are <em>LGM</em> and
<em>MID</em>. Examples of future periods includes “2061-2080” or “2100”.
<strong>Remember these periods needs to be part of the
filenames</strong>.</li>
<li>
<code>past_gcm</code> and/or <code>future_gcm</code>: character
vectors specifing the specific GCMS in past and/or future, respectively.
Examples of GCMS are “CCSM4”, “CNRM-CM5”, and “FGOALS-g2”.
<strong>Remember these GCMs needs to be part of the
filenames</strong>.</li>
<li>
<code>future_pscen</code>: character vectors specifing the specific
emission scenarios in the future, respectively. Examples of future_pscen
are “ssp126” and “ssp585. <strong>Remember these scenarios needs to be
part of the filenames</strong>.</li>
<li>
<code>variables_names</code> or <code>models</code>: a character
with the variables names or a <code>fitted_model</code> object (from
where the variables used in the model will be extracted).</li>
</ul>
<p>The function also allows to use a spatial object
(<code>SpatVector</code>, <code>SpatRaster</code>, or
<code>SpatExtent</code>) to mask the variables, and append static
variables (i.e., topographic variables) to the climatic variables.</p>
<p>Let’s use the <code><a href="../reference/organize_for_projection.html">organize_for_projection()</a></code> function to
organize the past variables representing the LGM conditions. The first
step is using the <code>list.files(path, full.names = TRUE</code> to
list the path to the variables representing present and LGM conditions.
Remembering, here we save the processed current variables in the
<code>present_dir</code> directory and the LGM variables in the
<code>dir_lgm</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">present_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">present_dir</span>, </span>
<span>                        pattern <span class="op">=</span> <span class="st">"Current_CHELSA"</span>,</span>
<span>                        full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">lgm_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">dir_lgm</span>, </span>
<span>                        pattern <span class="op">=</span> <span class="st">"LGM"</span>,</span>
<span>                        full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Let’s check the listed files to ensure they are storing the full path
to the variables of each scenario:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">present_list</span> <span class="co">#The paths in your computer will be different</span></span>
<span><span class="co">#&gt; "Local\\Temp\\Current_CHELSA.tif"</span></span>
<span></span>
<span><span class="va">lgm_list</span> <span class="co">#The paths in your computer will be different</span></span>
<span><span class="co">#&gt; [1] "Local\\Temp\\CHELSA_LGM_CCSM4.tif"       </span></span>
<span><span class="co">#&gt; [2] "Local\\Temp\\CHELSA_LGM_CNRM-CM5.tif"    </span></span>
<span><span class="co">#&gt; [3] "Local\\Temp\\CHELSA_LGM_FGOALS-g2.tif"   </span></span>
<span><span class="co">#&gt; [4] "Local\\Temp\\CHELSA_LGM_IPSL-CM5A-LR.tif"</span></span>
<span><span class="co">#&gt; [5] "Local\\Temp\\CHELSA_LGM_MIROC-ESM.tif"   </span></span>
<span><span class="co">#&gt; [6] "Local\\Temp\\CHELSA_LGM_MPI-ESM-P.tif"   </span></span>
<span><span class="co">#&gt; [7] "Local\\Temp\\CHELSA_LGM_MRI-CGCM3.tif"</span></span></code></pre></div>
<p>After check the files, we are ready to organize them:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a directory to save the variables</span></span>
<span><span class="co">#Here, in a temporary directory. Change to your work directory in your computer</span></span>
<span><span class="va">out_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Projection_variables"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/organize_for_projection.html">organize_for_projection</a></span><span class="op">(</span>output_dir <span class="op">=</span> <span class="va">out_dir</span>, </span>
<span>                        variable_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio1"</span>, <span class="st">"bio7"</span>, <span class="st">"bio12"</span>, <span class="st">"bio15"</span><span class="op">)</span>, </span>
<span>                        present_file <span class="op">=</span> <span class="va">present_list</span>, </span>
<span>                        past_files <span class="op">=</span> <span class="va">lgm_list</span>, </span>
<span>                        past_period <span class="op">=</span> <span class="st">"LGM"</span>, </span>
<span>                        past_gcm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CCSM4"</span>, <span class="st">"CNRM-CM5"</span>, <span class="st">"FGOALS-g2"</span>, </span>
<span>                                     <span class="st">"IPSL-CM5A-LR"</span>, <span class="st">"MIROC-ESM"</span>, <span class="st">"MPI-ESM-P"</span>,</span>
<span>                                     <span class="st">"MRI-CGCM3"</span><span class="op">)</span>,</span>
<span>                        resample_to_present <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variables successfully organized in directory:</span></span>
<span><span class="co">#&gt; /tmp/RtmpKT0qhA/Projection_variables</span></span></code></pre></div>
<p>We can check the files structured hierarchically in nested folders
using the <code><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree()</a></code> function from the <code>fs</code>
package:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Install package if necessary</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://fs.r-lib.org" class="external-link">"fs"</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"fs"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">out_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; Local\Temp\Projection_variables</span></span>
<span><span class="co">#&gt; ├── Past</span></span>
<span><span class="co">#&gt; │   └── LGM</span></span>
<span><span class="co">#&gt; │       ├── CCSM4</span></span>
<span><span class="co">#&gt; │       │   └── Variables.tif</span></span>
<span><span class="co">#&gt; │       ├── CNRM-CM5</span></span>
<span><span class="co">#&gt; │       │   └── Variables.tif</span></span>
<span><span class="co">#&gt; │       ├── FGOALS-g2</span></span>
<span><span class="co">#&gt; │       │   └── Variables.tif</span></span>
<span><span class="co">#&gt; │       ├── IPSL-CM5A-LR</span></span>
<span><span class="co">#&gt; │       │   └── Variables.tif</span></span>
<span><span class="co">#&gt; │       ├── MIROC-ESM</span></span>
<span><span class="co">#&gt; │       │   └── Variables.tif</span></span>
<span><span class="co">#&gt; │       ├── MPI-ESM-P</span></span>
<span><span class="co">#&gt; │       │   └── Variables.tif</span></span>
<span><span class="co">#&gt; │       └── MRI-CGCM3</span></span>
<span><span class="co">#&gt; │           └── Variables.tif</span></span>
<span><span class="co">#&gt; └── Present</span></span>
<span><span class="co">#&gt;     └── Variables.tif</span></span></code></pre></div>
<p>After organizing variables, the next step is to create the
<code>prepared_projection</code> object.</p>
<p>But before it, let’s import a <code>fitted_model</code> provided as
data example in the <code>kuenm2</code> package, which were calibrated
using the current variables from CHELSA used in this example. For more
information on <a href="prepare_data.html">data preparation</a>, <a href="model_calibration">model calibration</a> and <a href="model_exploration.html">model exploration</a>, consult the
respective vignetts.</p>
</div>
<div class="section level2">
<h2 id="preparation-of-data-for-model-projections">Preparation of data for model projections<a class="anchor" aria-label="anchor" href="#preparation-of-data-for-model-projections"></a>
</h2>
<p>Now, let’s prepare data for model projections across multiple
scenarios, storing the paths to the rasters representing each scenario.
We need the paths to the folders where the raster files are stored. This
includes the variables for the present time, which were used to
calibrate and fit the models.</p>
<p>In addition to storing the paths to the variables for each scenario,
the function also verifies if all variables used to fit the final models
are available across all scenarios. To perform this check, you need to
provide either the <code>fitted_models</code> object you intend to use
for projection or simply the variable names. We strongly suggest using
the <code>fitted_models</code> object to minimize projection errors.</p>
<p>We also need to define the root directory containing the scenarios
for projection (present, past, and/or future), along with additional
information regarding time periods, SSPs, and GCMs.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Define present_dir and past_dir</span></span>
<span><span class="va">in_dir_present</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_dir</span>, <span class="st">"Present"</span><span class="op">)</span></span>
<span><span class="va">in_dir_past</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_dir</span>, <span class="st">"Past"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare projections using fitted models to check variables</span></span>
<span><span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_projection.html">prepare_projection</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_chelsa</span>,</span>
<span>                         present_dir <span class="op">=</span> <span class="va">in_dir_present</span>, <span class="co">#Directory with present-day variables</span></span>
<span>                         past_dir <span class="op">=</span> <span class="va">in_dir_past</span>, </span>
<span>                         past_period <span class="op">=</span> <span class="st">"LGM"</span>, </span>
<span>                         past_gcm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CCSM4"</span>, <span class="st">"CNRM-CM5"</span>, <span class="st">"FGOALS-g2"</span>, </span>
<span>                                      <span class="st">"IPSL-CM5A-LR"</span>, <span class="st">"MIROC-ESM"</span>, <span class="st">"MPI-ESM-P"</span>,</span>
<span>                                      <span class="st">"MRI-CGCM3"</span><span class="op">)</span>, </span>
<span>                         future_dir <span class="op">=</span> <span class="cn">NULL</span>, <span class="co">#NULL because we won't project to the past</span></span>
<span>                         future_period <span class="op">=</span> <span class="cn">NULL</span>, <span class="co">#NULL because we won't project to the past</span></span>
<span>                         future_pscen <span class="op">=</span> <span class="cn">NULL</span>, <span class="co">#NULL because we won't project to the past</span></span>
<span>                         future_gcm <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="co">#NULL because we won't project to the past</span></span></code></pre></div>
<p>When we print the <code>projection_data</code> object, it summarizes
all the scenarios we will predict and also shows the root directory
where the predictor rasters are stored:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pr</span></span>
<span><span class="co">#&gt; projection_data object summary</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Variables prepared to project models for Present and Past </span></span>
<span><span class="co">#&gt; Past projections contain the following periods and GCMs:</span></span>
<span><span class="co">#&gt;   - Periods: LGM </span></span>
<span><span class="co">#&gt;   - GCMs: CCSM4 | CNRM-CM5 | FGOALS-g2 | IPSL-CM5A-LR | MIROC-ESM | MPI-ESM-P | MRI-CGCM3 </span></span>
<span><span class="co">#&gt; All variables are located in the following root directory:</span></span>
<span><span class="co">#&gt; Local/Temp/Projection_variables</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="project-selected-models-to-multiple-scenarios">Project selected models to multiple scenarios<a class="anchor" aria-label="anchor" href="#project-selected-models-to-multiple-scenarios"></a>
</h2>
<p>After preparing the data, we can use the
<code><a href="../reference/project_selected.html">project_selected()</a></code> function to predict the selected models
across the multiple scenarios specified in
<code>prepare_projections</code>. For a comprehensive detail on this
step, please see the <a href="model_projections.html">Project models to
multiple scenarios</a> vignette.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a folder to save projection results</span></span>
<span><span class="co">#Here, in a temporary directory</span></span>
<span><span class="va">out_dir_projections</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Projection_results/chelsa"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">out_dir_projections</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Project selected models to multiple scenarios</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project_selected.html">project_selected</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_chelsa</span>, </span>
<span>                      projection_data <span class="op">=</span> <span class="va">pr</span>,</span>
<span>                      out_dir <span class="op">=</span> <span class="va">out_dir_projections</span>, </span>
<span>                      write_replicates <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                      progress_bar <span class="op">=</span> <span class="cn">FALSE</span>, overwrite <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="co">#Do not print progress bar</span></span>
<span></span>
<span><span class="co">#Import mean of each projected scenario</span></span>
<span><span class="va">p_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_projections.html">import_projections</a></span><span class="op">(</span>projection <span class="op">=</span> <span class="va">p</span>, consensus <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span><span class="co">#Plot all scenarios</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_mean</span>, cex.main <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="organize_past_chelsa_files/figure-html/project%20selected-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="compute-changes">Compute changes<a class="anchor" aria-label="anchor" href="#compute-changes"></a>
</h2>
<p>When projecting a niche model to different temporal scenarios (past
or future), species’ areas can be classified into three categories
relative to the current baseline: <strong>gain</strong>,
<strong>loss</strong> and <strong>stability</strong>. The interpretation
of these categories depends on the temporal direction of the
projection.</p>
<p><strong>When projecting to future scenarios</strong>:</p>
<ul>
<li>
<em>Gain</em>: Areas that are currently unsuitable become suitable
in the future.</li>
<li>
<em>Loss</em>: Areas that are currently suitable become unsuitable
in the future.</li>
<li>
<em>Stability</em>: Areas that retain their current classification
in the future, whether suitable or unsuitable.</li>
</ul>
<p><strong>When projecting to past scenarios</strong>:</p>
<ul>
<li>
<em>Gain</em>: Areas that were unsuitable in the past are now
suitable in the present.</li>
<li>
<em>Loss</em>: Areas that were suitable in the past are now
unsuitable in the present.</li>
<li>
<em>Stability</em>: Areas that retain their past classification in
the present, whether suitable or unsuitable.</li>
</ul>
<p>These outcomes may vary across different General Circulation Models
(GCMs) within each time scenario (e.g., various Shared Socioeconomic
Pathways (SSPs) for the same period).</p>
<p>The <code><a href="../reference/projection_changes.html">projection_changes()</a></code> function summarizes the number
of GCMs predicting gain, loss, and stability for each time scenario.</p>
<p>Here, we present an example of projected changes from LGM conditions
to the current period. For an example of changes from the present to
future conditions, along with more details on this function, see the <a href="variability_and_uncertainty.html">Exploring Model Uncertainty and
Variability vignette</a>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">changes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/projection_changes.html">projection_changes</a></span><span class="op">(</span>model_projections <span class="op">=</span> <span class="va">p</span>, consensus <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                              output_dir <span class="op">=</span> <span class="va">out_dir_projections</span>, </span>
<span>                              write_bin_models <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Write individual binarized results</span></span>
<span>                              return_raster <span class="op">=</span> <span class="cn">TRUE</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Set colors</span></span>
<span><span class="va">summary_with_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colors_for_changes.html">colors_for_changes</a></span><span class="op">(</span>changes_projections <span class="op">=</span> <span class="va">changes</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">summary_with_colors</span><span class="op">$</span><span class="va">Summary_changes</span><span class="op">)</span></span></code></pre></div>
<p><img src="organize_past_chelsa_files/figure-html/changes-1.png" width="672"></p>
<p>In this example, we can see that under present-day conditions, most
GCMs indicate the species lost much of its suitable area during the
LGM.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Weverton C. F. Trindade, Luis F. Arias-Giraldo, Luis Osorio-Olvera, A. Townsend Peterson, Marlon E. Cobos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
