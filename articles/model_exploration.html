<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fit and Explore Selected Models • kuenm2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit and Explore Selected Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">kuenm2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.10</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic_bata_cleaning.html">Occurrene Data Cleaning</a></li>
    <li><a class="dropdown-item" href="../articles/model_calibration.html">Model Calibration</a></li>
    <li><a class="dropdown-item" href="../articles/model_exploration.html">Fit and Explore Selected Models</a></li>
    <li><a class="dropdown-item" href="../articles/prepare_data.html">Prepare Data for Model Calibration</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fit and Explore Selected Models</h1>
            
      

      <div class="d-none name"><code>model_exploration.Rmd</code></div>
    </div>

    
    
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#response-curve">Response curve</a></li>
<li><a href="#variable-importance">Variable importance</a></li>
<li><a href="#saving-a-fitted_models-object">Saving a fitted_models
object</a></li>
</ul>
<hr>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>After the best performing models have been selected, users need to
fit this models (using <code><a href="../reference/fit_selected.html">fit_selected()</a></code>) in order to explore
their characteristics and continue with the next steps. Fitted models
can then be used to assess variable importance in models, as well as to
explore variable response curves.</p>
<p>To fit the selected models, we need a
<code>calibration_results</code> object. For more details in model
calibration, please refer to the vignette <a href="/articles/model_calibration.html">Model Calibration</a>. The
<code>calibration_results</code> object generated in this vignette is
available as a data example in the package. Let’s load it.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marlonecobos.github.io/kuenm2/">kuenm2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.54</span></span>
<span></span>
<span><span class="co">#Import calib_results_maxnet</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"calib_results_maxnet"</span>, package <span class="op">=</span> <span class="st">"kuenm2"</span><span class="op">)</span></span>
<span><span class="co">#Print calibration result</span></span>
<span><span class="va">calib_results_maxnet</span></span>
<span><span class="co">#&gt; calibration_results object summary (maxnet)</span></span>
<span><span class="co">#&gt; =============================================================</span></span>
<span><span class="co">#&gt; Species: Myrcia hatschbachii </span></span>
<span><span class="co">#&gt; Number of candidate models: 300 </span></span>
<span><span class="co">#&gt;   - Models removed because they failed to fit: 0 </span></span>
<span><span class="co">#&gt;   - Models identified with concave curves: 35 </span></span>
<span><span class="co">#&gt;   - Model with concave curves not removed </span></span>
<span><span class="co">#&gt;   - Models removed with non-significant values of pROC: 0 </span></span>
<span><span class="co">#&gt;   - Models removed with omission error &gt; 5%: 147 </span></span>
<span><span class="co">#&gt;   - Models removed with delta AIC &gt; 2: 151 </span></span>
<span><span class="co">#&gt; Selected models: 2 </span></span>
<span><span class="co">#&gt;   - Up to 5 printed here:</span></span>
<span><span class="co">#&gt;      ID                                                           Formulas</span></span>
<span><span class="co">#&gt; 159 159                        ~bio_1 + bio_7 + I(bio_1^2) + I(bio_7^2) -1</span></span>
<span><span class="co">#&gt; 189 189 ~bio_1 + bio_7 + bio_12 + I(bio_1^2) + I(bio_7^2) + I(bio_12^2) -1</span></span>
<span><span class="co">#&gt;     Features R_multiplier pval_pROC_at_5.mean Omission_rate_at_5.mean      dAIC</span></span>
<span><span class="co">#&gt; 159       lq          0.1                   0                  0.0192 0.4418045</span></span>
<span><span class="co">#&gt; 189       lq          0.1                   0                  0.0192 0.0000000</span></span>
<span><span class="co">#&gt;     Parameters</span></span>
<span><span class="co">#&gt; 159          3</span></span>
<span><span class="co">#&gt; 189          5</span></span></code></pre></div>
<p>This object contains the results of candidate models calibrated using
the <code>maxnet</code> algorithm. The package also provides a similar
example using the <code>glm</code> algorithm, which works in exactly the
same way.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Import calib_results_glm</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"calib_results_glm"</span>, package <span class="op">=</span> <span class="st">"kuenm2"</span><span class="op">)</span></span>
<span><span class="co">#Print calibration result</span></span>
<span><span class="va">calib_results_glm</span></span>
<span><span class="co">#&gt; calibration_results object summary (glm)</span></span>
<span><span class="co">#&gt; =============================================================</span></span>
<span><span class="co">#&gt; Species: Myrcia hatschbachii </span></span>
<span><span class="co">#&gt; Number of candidate models: 100 </span></span>
<span><span class="co">#&gt;   - Models removed because they failed to fit: 0 </span></span>
<span><span class="co">#&gt;   - Models identified with concave curves: 18 </span></span>
<span><span class="co">#&gt;   - Model with concave curves not removed </span></span>
<span><span class="co">#&gt;   - Models removed with non-significant values of pROC: 0 </span></span>
<span><span class="co">#&gt;   - Models removed with omission error &gt; 5%: 50 </span></span>
<span><span class="co">#&gt;   - Models removed with delta AIC &gt; 2: 49 </span></span>
<span><span class="co">#&gt; Selected models: 1 </span></span>
<span><span class="co">#&gt;   - Up to 5 printed here:</span></span>
<span><span class="co">#&gt;    ID</span></span>
<span><span class="co">#&gt; 86 86</span></span>
<span><span class="co">#&gt;                                                                                                       Formulas</span></span>
<span><span class="co">#&gt; 86 ~bio_1 + bio_7 + bio_15 + I(bio_1^2) + I(bio_7^2) + I(bio_15^2) + bio_1:bio_7 + bio_1:bio_15 + bio_7:bio_15</span></span>
<span><span class="co">#&gt;    Features pval_pROC_at_5.mean Omission_rate_at_5.mean dAIC Parameters</span></span>
<span><span class="co">#&gt; 86      lqp                   0                  0.0192    0          9</span></span></code></pre></div>
<p>Note that the <code>calibration_results</code> object stores only the
information related to the calibration process and model evaluation—it
does not include the fitted <code>maxnet</code> (or <code>glm</code>)
models themselves.</p>
<p>To obtain the final fitted models, we need to use the
<code><a href="../reference/fit_selected.html">fit_selected()</a></code> function. By default, this function fits a
full model (i.e., without replicates and without splitting the data into
training and testing sets). However, you can configure it to fit final
models with replicates if desired.</p>
<p>In this example, we’ll fit the final models using the same
replication settings (4-fold cross-validation) as used in the <a href="/articles/model_calibration.html">Model Calibration</a>
vignette.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit selected models using calibration results</span></span>
<span><span class="va">fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_selected.html">fit_selected</a></span><span class="op">(</span>calibration_results <span class="op">=</span> <span class="va">calib_results_maxnet</span>, <span class="co">#or calib_results_glm</span></span>
<span>                   n_replicates <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co"># Fitting replicates...</span></span>
<span><span class="co">#   |========================================================================| 100%</span></span>
<span><span class="co"># Fitting full models...</span></span>
<span><span class="co">#   |========================================================================| 100%</span></span></code></pre></div>
<p><br></p>
<p>The <code><a href="../reference/fit_selected.html">fit_selected()</a></code> function returns a
<code>fitted_models</code> object, a list that contains essential
information from the fitted models, which is required for the subsequent
steps.</p>
<p>You can explore the contents of the <code>fitted_models</code> object
by indexing its elements. For example, the fitted <code>maxnet</code>
(or <code>glm</code>) model objects are stored within the
<code>Models</code> element. Note that <code>Models</code> is a nested
list: for each selected model (in this case, models 159 and 189), it
includes both the replicates (if fitted with replicates) and the full
model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#See names of selected models</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fm</span><span class="op">$</span><span class="va">Models</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Model_159" "Model_189"</span></span>
<span></span>
<span><span class="co">#See models inside Model 189</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fm</span><span class="op">$</span><span class="va">Models</span><span class="op">$</span><span class="va">Model_189</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Rep_1"      "Rep_2"      "Rep_3"      "Rep_4"      "Full_model"</span></span></code></pre></div>
<p>The <code>fitted_models</code> object also stores the thresholds that
can be used to binarize the models into suitable and unsuitable areas.
These thresholds correspond to the omission error used during model
selection (e.g., 5% or 10%).</p>
<p>You can access the omission error used to calculate the thresholds
directly from the object:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Get omission error used to select models and calculate the thesholds</span></span>
<span><span class="va">fm</span><span class="op">$</span><span class="va">omission_rate</span></span>
<span><span class="co">#&gt; [1] 5</span></span></code></pre></div>
<p>The omission error used to calculate the thresholds was 5%, meaning
that when the predictions are binarized, approximately 5% of the
presence records used to calibrate the models will fall into cells with
predicted values below the threshold.</p>
<p>The thresholds are summarized in two ways: the mean and median across
replicates for each model, and the consensus mean and median across all
selected models (when more than one model is selected):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fm</span><span class="op">$</span><span class="va">thresholds</span></span>
<span><span class="co">#&gt; $Model_159</span></span>
<span><span class="co">#&gt; $Model_159$mean</span></span>
<span><span class="co">#&gt; [1] 0.2976193</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Model_159$median</span></span>
<span><span class="co">#&gt; [1] 0.314841</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Model_189</span></span>
<span><span class="co">#&gt; $Model_189$mean</span></span>
<span><span class="co">#&gt; [1] 0.3298963</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Model_189$median</span></span>
<span><span class="co">#&gt; [1] 0.3491305</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $consensus</span></span>
<span><span class="co">#&gt; $consensus$mean</span></span>
<span><span class="co">#&gt; [1] 0.315051</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $consensus$median</span></span>
<span><span class="co">#&gt; [1] 0.336047</span></span></code></pre></div>
<p>Now, we can use the <code>fitted_models</code> object to generate
response curves and compute variable importance.</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="response-curve">Response curve<a class="anchor" aria-label="anchor" href="#response-curve"></a>
</h2>
<p>The response curves illustrate how each environmental variable
influences the predicted suitability, while keeping all other variables
constant.</p>
<p>By default, the curves are generated with all other variables set to
their mean values (or the mode for categorical variables), calculated
from the combined set of presence and background localities
(<code>averages_from = "pr_bg"</code>). You can change this behavior to
use only the presence localities by setting
<code>averages_from = "pr"</code>.</p>
<p>Let’s check which variables are available to plot by examining the
coefficients of the full models:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Get variables with non-zero coefficients in the models</span></span>
<span><span class="va">fm</span><span class="op">$</span><span class="va">Models</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Full_model</span><span class="op">$</span><span class="va">betas</span> <span class="co">#From the first model selected</span></span>
<span><span class="co">#&gt;       bio_1  I(bio_1^2)  I(bio_7^2) </span></span>
<span><span class="co">#&gt; 15.52377637 -0.46828240 -0.01261841</span></span>
<span><span class="va">fm</span><span class="op">$</span><span class="va">Models</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Full_model</span><span class="op">$</span><span class="va">betas</span> <span class="co">#From the second model selected</span></span>
<span><span class="co">#&gt;         bio_1        bio_12    I(bio_1^2)    I(bio_7^2)   I(bio_12^2) </span></span>
<span><span class="co">#&gt;  1.462835e+01  3.592615e-02 -4.407921e-01 -1.208573e-02 -1.152889e-05</span></span></code></pre></div>
<p>The variables <code>bio_1</code>, <code>bio_7</code>, and
<code>bio_12</code> have non-zero coefficient values, which means they
contribute to the model and are available for generating response
curves.</p>
<p>By default, response curves are computed using all selected models.
The resulting plots include a line for the mean response, along with a
shaded area representing the 95% confidence interval.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="co">#Set grid of plot</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span>, variable <span class="op">=</span> <span class="st">"bio_1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span>, variable <span class="op">=</span> <span class="st">"bio_7"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span>, variable <span class="op">=</span> <span class="st">"bio_12"</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_exploration_files/figure-html/response%20curve-1.png" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#Reinitiate grid</span></span></code></pre></div>
<p>We can also specify which of the selected models should be used to
generate the response curves:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co">#Set grid of plot</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span>, variable <span class="op">=</span> <span class="st">"bio_1"</span>,</span>
<span>               modelID <span class="op">=</span> <span class="st">"Model_159"</span>, main <span class="op">=</span> <span class="st">"Model_159"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span>, variable <span class="op">=</span> <span class="st">"bio_1"</span>, </span>
<span>               modelID <span class="op">=</span> <span class="st">"Model_189"</span>, main <span class="op">=</span> <span class="st">"Model_189"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span>, variable <span class="op">=</span> <span class="st">"bio_7"</span>, </span>
<span>               modelID <span class="op">=</span> <span class="st">"Model_159"</span>, main <span class="op">=</span> <span class="st">"Model_159"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span>, variable <span class="op">=</span> <span class="st">"bio_7"</span>, </span>
<span>               modelID <span class="op">=</span> <span class="st">"Model_189"</span>, main <span class="op">=</span> <span class="st">"Model_189"</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_exploration_files/figure-html/response%20ID-1.png" width="672"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#Reinitiate grid</span></span></code></pre></div>
<p>The dashed lines indicate the range of the variable within the
calibration data. By default, the plot extends beyond these limits based
on the variable’s minimum and maximum values and the
<code>extrapolation_factor</code> (when
<code>extrapolation = TRUE</code>). The default extrapolation is set to
10% of the variable’s range (i.e., <strong>range × 0.1</strong>).</p>
<p>If <code>extrapolation = FALSE</code>, no extrapolation occurs, and
the plot limits match the calibration data range exactly.</p>
<p>We can increase the extrapolation factor to allow a broader range
beyond the observed data. Below is the response curve plotted with an
extrapolation factor of 2:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="co">#Set grid of plot</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span>, variable <span class="op">=</span> <span class="st">"bio_1"</span>, extrapolation_factor <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span>, variable <span class="op">=</span> <span class="st">"bio_7"</span>, extrapolation_factor <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span>, variable <span class="op">=</span> <span class="st">"bio_12"</span>, extrapolation_factor <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_exploration_files/figure-html/extrapolation%20factor-1.png" width="672"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#Reinitiate grid</span></span></code></pre></div>
<p>Note that the response curve now extends further beyond the observed
data range (indicated by the dashed lines).</p>
<p>Optionally, we can manually set the lower and upper limits of the
variables. For example, since <code>bio_12</code> represents annual
precipitation and negative values are not meaningful, we can set its
lower limit to 0:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span>, variable <span class="op">=</span> <span class="st">"bio_12"</span>, </span>
<span>               extrapolation_factor <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>               l_limit <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_exploration_files/figure-html/lower%20limit-1.png" width="672"></p>
<p>Now, the lower limit of the plot for <code>bio_12</code> is set to 0.
Since we did not specify an upper limit, the plot uses the extrapolation
factor (here, 0.1) to define the upper limit.</p>
<p>Optionally, we can add the original presence and background points to
the plot by setting <code>add_point = TRUE</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span>, variable <span class="op">=</span> <span class="st">"bio_1"</span>, </span>
<span>               add_points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_exploration_files/figure-html/add%20points-1.png" width="672"></p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="variable-importance">Variable importance<a class="anchor" aria-label="anchor" href="#variable-importance"></a>
</h2>
<p>The relative importance of predictor variables can be calculated
using explained deviance through the <code>var_importance()</code>
function. This process starts by fitting the full model
(<code>maxnet</code> or <code>glm</code>), which includes all predictor
variables. Then, the function fits separate models excluding one
variable at a time, assessing how the removal affects model
performance.</p>
<p>By systematically evaluating the impact of each predictor’s
exclusion, the function provides insights into the individual
contribution of each variable to the model’s overall performance and
explanatory power.</p>
<p>By default, the function runs on a single core. You can enable
parallel processing by setting <code>parallel = TRUE</code> and
specifying the number of cores with <code>ncores</code>. Note that
parallelization only speeds up the computation when there are many
variables (more than 7) and a large calibration dataset (over 15,000
presence and background points).</p>
<p>By default, variable importance is computed for all selected
models:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate variable importance</span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/variable_importance.html">variable_importance</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculating variable contribution for model 1 of 2</span></span>
<span><span class="co">#   |======================================================================| 100%</span></span>
<span><span class="co"># Calculating variable contribution for model 2 of 2</span></span>
<span><span class="co">#   |======================================================================| 100%</span></span></code></pre></div>
<p>The function returns a <code>data.frame</code> with the relative
contribution of each variable. If multiple models are included in the
<code>fitted</code> object, an additional column identifies each
distinct model.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imp</span></span>
<span><span class="co">#&gt;     predictor contribution    Models</span></span>
<span><span class="co">#&gt; 1  I(bio_1^2)  0.515387743 Model_159</span></span>
<span><span class="co">#&gt; 2       bio_1  0.482802883 Model_159</span></span>
<span><span class="co">#&gt; 3  I(bio_7^2)  0.001809375 Model_159</span></span>
<span><span class="co">#&gt; 4  I(bio_1^2)  0.444939057 Model_189</span></span>
<span><span class="co">#&gt; 5       bio_1  0.425438027 Model_189</span></span>
<span><span class="co">#&gt; 6 I(bio_12^2)  0.065575776 Model_189</span></span>
<span><span class="co">#&gt; 7      bio_12  0.062618167 Model_189</span></span>
<span><span class="co">#&gt; 8  I(bio_7^2)  0.001428973 Model_189</span></span></code></pre></div>
<p>We can visualize variable importance using the
<code><a href="../reference/plot_importance.html">plot_importance()</a></code> function. When the
<code>fitted_models</code> object contains more than one selected model,
the plot displays a boxplot of contributions, along with the mean
contribution and the number (N) of fitted models.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_importance.html">plot_importance</a></span><span class="op">(</span><span class="va">imp</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_exploration_files/figure-html/plot%20importance-1.png" width="672"></p>
<p>If variable importance is computed for a single model, the plot
displays a barplot instead of a boxplot:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate variable importance for a specific selected Model</span></span>
<span><span class="va">imp_189</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/variable_importance.html">variable_importance</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fm</span>, modelID <span class="op">=</span> <span class="st">"Model_189"</span>, </span>
<span>                               progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#Plot variable contribution for model 189</span></span>
<span><span class="fu"><a href="../reference/plot_importance.html">plot_importance</a></span><span class="op">(</span><span class="va">imp_189</span>, main <span class="op">=</span> <span class="st">"Variable importance - Model 189"</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_exploration_files/figure-html/one%20model%20importance-1.png" width="672"><br></p>
</div>
<div class="section level2">
<h2 id="saving-a-fitted_models-object">Saving a fitted_models object<a class="anchor" aria-label="anchor" href="#saving-a-fitted_models-object"></a>
</h2>
<p>After fitting the best-performing models with
<code><a href="../reference/fit_selected.html">fit_selected()</a></code>, we can proceed to predict the models for
single or multiple scenarios. As this object is essentially a list,
users can save it to a local directory using <code><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">saveRDS()</a></code>.
Saving the object facilitates loading it back into your R session later
using <code><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS()</a></code>. See an example below:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set directory to save (here, in a temporary directory)</span></span>
<span><span class="va">dir_to_save</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the data</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">fm</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_to_save</span>, <span class="st">"fitted_models.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import data</span></span>
<span><span class="va">fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_to_save</span>, <span class="st">"fitted_models.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marlon E. Cobos, Weverton Trindade, Luis F. Arias-Giraldo, Luis Osorio-Olvera, A. Townsend Peterson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
