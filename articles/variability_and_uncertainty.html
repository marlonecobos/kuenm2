<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Exploring Model Uncertainty and Variability • kuenm2</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Exploring Model Uncertainty and Variability">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">kuenm2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.10</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-book"></span> Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic_data_cleaning.html">1. Occurrence Data Cleaning</a></li>
    <li><a class="dropdown-item" href="../articles/prepare_data.html">2. Prepare Data for Model Calibration</a></li>
    <li><a class="dropdown-item" href="../articles/model_calibration.html">3. Model Calibration</a></li>
    <li><a class="dropdown-item" href="../articles/model_exploration.html">4. Fit and Explore Selected Models</a></li>
    <li><a class="dropdown-item" href="../articles/model_predictions.html">5. Predict models to single scenario</a></li>
    <li><a class="dropdown-item" href="../articles/model_projections.html">6. Project models to multiple scenarios</a></li>
    <li><a class="dropdown-item" href="../articles/variability_and_uncertainty.html">7. Exploring Model Uncertainty and Variability</a></li>
    <li><a class="dropdown-item" href="../articles/organize_past_chelsa.html">8. Organize projections manually</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/marlonecobos/kuenm2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Exploring Model Uncertainty and Variability</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/marlonecobos/kuenm2/blob/main/vignettes/variability_and_uncertainty.Rmd" class="external-link"><code>vignettes/variability_and_uncertainty.Rmd</code></a></small>
      <div class="d-none name"><code>variability_and_uncertainty.Rmd</code></div>
    </div>

    
    
<ul>
<li><a href="#introduction">Introduction</a></li>
<li>
<a href="#compute-changes-between-scenarios">Compute Changes Between
Scenarios</a>
<ul>
<li><a href="#set-colors-for-change-maps">Set Colors for Change
Maps</a></li>
<li><a href="#types-os-results">Types os results</a></li>
<li><a href="#importing-results">Importing Results</a></li>
<li><a href="#save-changes_projections">Save
changes_projections</a></li>
</ul>
</li>
<li>
<a href="#explore-variance">Explore Variance</a>
<ul>
<li><a href="#importing-results-1">Importing Results</a></li>
<li><a href="#saving-the-variability_projections-object">Saving the
variability_projections Object</a></li>
</ul>
</li>
<li>
<a href="#analyze-extrapolation-risks-using-the-mop-metric">Analyze
Extrapolation Risks Using the MOP Metric</a>
<ul>
<li>
<a href="#mop-types">MOP types</a>
<ul>
<li><a href="#distances">Distances</a></li>
<li><a href="#basic">Basic</a></li>
<li><a href="#simple">Simple</a></li>
<li><a href="#combined-towards-highlow">Combined Towards
High/Low</a></li>
<li><a href="#towards-highlow-end">Towards High/Low End</a></li>
</ul>
</li>
<li><a href="#handling-in-range-values-na-or-zero">Handling In-Range
Values: NA or Zero</a></li>
<li><a href="#comparing-mop-results-with-response-curves">Comparing MOP
Results with Response Curves</a></li>
<li><a href="#saving-and-importing-mop-results">Saving and Importing MOP
Results</a></li>
</ul>
</li>
</ul>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>After projecting models across multiple scenarios using the
<code><a href="../reference/project_selected.html">project_selected()</a></code> function, several types of analyses can
be performed:</p>
<ul>
<li>
<strong>Compute changes</strong> between scenarios using the
<code><a href="../reference/projection_changes.html">projection_changes()</a></code> function.</li>
<li>
<strong>Explore variability</strong> arising from replicates, model
parameterizations, and General Circulation Models (GCMs) with
<code><a href="../reference/projection_variability.html">projection_variability()</a></code>.</li>
<li>
<strong>Assess extrapolation risks</strong> through analysis with
<code><a href="../reference/projection_mop.html">projection_mop()</a></code>.</li>
</ul>
<p>These analyses require a <code>model_projections</code> object, which
is the output of <code><a href="../reference/project_selected.html">project_selected()</a></code>. This object contains
the predicted scenario data as well as the directory paths where the
projection rasters are saved.</p>
<p>To create this object, follow the steps outlined below and described
in the <a href="model_projections.html">“Project models to multiple
scenarios”</a> vignette.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marlonecobos.github.io/kuenm2/">kuenm2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.60</span></span>
<span></span>
<span><span class="co">#Import calib_results_maxnet</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fitted_model_maxnet"</span>, package <span class="op">=</span> <span class="st">"kuenm2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import path to raster files with future predictors provided as example</span></span>
<span><span class="co"># The data is located in the "inst/extdata" folder.</span></span>
<span><span class="va">in_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"kuenm2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import raster layers (same used to calibrate and fit final models)</span></span>
<span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Current_variables.tif"</span>, package <span class="op">=</span> <span class="st">"kuenm2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#Get soilType</span></span>
<span><span class="va">soiltype</span> <span class="op">&lt;-</span> <span class="va">var</span><span class="op">$</span><span class="va">SoilType</span></span>
<span></span>
<span><span class="co"># Organize and structure WorldClim files</span></span>
<span><span class="co">#Create folder to save structured files</span></span>
<span><span class="va">out_dir_future</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Future_raw"</span><span class="op">)</span> <span class="co">#Here, in a temporary directory</span></span>
<span><span class="co">#Organize</span></span>
<span><span class="fu"><a href="../reference/organize_future_worldclim.html">organize_future_worldclim</a></span><span class="op">(</span>input_dir <span class="op">=</span> <span class="va">in_dir</span>, <span class="co">#Path to the raw variables from WorldClim</span></span>
<span>                          output_dir <span class="op">=</span> <span class="va">out_dir_future</span>, </span>
<span>                          name_format <span class="op">=</span> <span class="st">"bio_"</span>, <span class="co">#Name format</span></span>
<span>                          fixed_variables <span class="op">=</span> <span class="va">var</span><span class="op">$</span><span class="va">SoilType</span>, <span class="co">#Static variables</span></span>
<span>                          progress_bar <span class="op">=</span> <span class="cn">FALSE</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variables successfully organized in directory:</span></span>
<span><span class="co">#&gt; /tmp/RtmpRqDWCW/Future_raw</span></span>
<span></span>
<span><span class="co"># Create a "Current_raw" folder in a temporary directory</span></span>
<span><span class="co">#and copy the rawvariables there.</span></span>
<span><span class="va">out_dir_current</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Current_raw"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">out_dir_current</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save current variables in temporary directory</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">var</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_dir_current</span>, <span class="st">"Variables.tif"</span><span class="op">)</span>, </span>
<span>                   overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare projections using fitted models to check variables</span></span>
<span><span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_projection.html">prepare_projection</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>,</span>
<span>                         present_dir <span class="op">=</span> <span class="va">out_dir_current</span>, <span class="co">#Directory with present-day variables</span></span>
<span>                         future_dir <span class="op">=</span> <span class="va">out_dir_future</span>, <span class="co">#Directory with future variables</span></span>
<span>                         future_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2041-2060"</span>, <span class="st">"2081-2100"</span><span class="op">)</span>,</span>
<span>                         future_pscen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ssp126"</span>, <span class="st">"ssp585"</span><span class="op">)</span>,</span>
<span>                         future_gcm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ACCESS-CM2"</span>, <span class="st">"MIROC6"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Project selected models to multiple scenarios</span></span>
<span><span class="co">## Create a folder to save projection results</span></span>
<span><span class="co">#Here, in a temporary directory</span></span>
<span><span class="va">out_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Projection_results/maxnet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">out_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Project selected models to multiple scenarios</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project_selected.html">project_selected</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, </span>
<span>                      projection_data <span class="op">=</span> <span class="va">pr</span>,</span>
<span>                      out_dir <span class="op">=</span> <span class="va">out_dir</span>,</span>
<span>                      write_replicates <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                      progress_bar <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#Do not print progress bar</span></span>
<span>                      overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="compute-changes-between-scenarios">Compute Changes Between Scenarios<a class="anchor" aria-label="anchor" href="#compute-changes-between-scenarios"></a>
</h2>
<p>When projecting a niche model to different temporal scenarios (past
or future), species’ areas can be classified into three categories
relative to the current baseline: <strong>gain</strong>,
<strong>loss</strong> and <strong>stability</strong>. The interpretation
of these categories depends on the temporal direction of the
projection.</p>
<p><strong>When projecting to future scenarios</strong>:</p>
<ul>
<li>
<em>Gain</em>: Areas that are currently unsuitable become suitable
in the future.</li>
<li>
<em>Loss</em>: Areas that are currently suitable become unsuitable
in the future.</li>
<li>
<em>Stability</em>: Areas that retain their current classification
in the future, whether suitable or unsuitable.</li>
</ul>
<p><strong>When projecting to past scenarios</strong>:</p>
<ul>
<li>
<em>Gain</em>: Areas that were unsuitable in the past are now
suitable in the present.</li>
<li>
<em>Loss</em>: Areas that were suitable in the past are now
unsuitable in the present.</li>
<li>
<em>Stability</em>: Areas that retain their past classification in
the present, whether suitable or unsuitable.</li>
</ul>
<p>These outcomes may vary across different General Circulation Models
(GCMs) within each time scenario (e.g., various Shared Socioeconomic
Pathways (SSPs) for the same period).</p>
<p>The <code><a href="../reference/projection_changes.html">projection_changes()</a></code> function summarizes the number
of GCMs predicting gain, loss, and stability for each time scenario.</p>
<p>By default, this function writes the summary results to disk (unless
<code>write_results</code> is set to <code>FALSE</code>), but it does
not save the binarized results for individual GCMs. In the example
below, we demonstrate how to configure the function to both return the
resulting rasters and write the binarized results to disk.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">changes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/projection_changes.html">projection_changes</a></span><span class="op">(</span>model_projections <span class="op">=</span> <span class="va">p</span>, </span>
<span>                              output_dir <span class="op">=</span> <span class="va">out_dir</span>, </span>
<span>                              write_bin_models <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Write individual binarized results</span></span>
<span>                              return_raster <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="set-colors-for-change-maps">Set Colors for Change Maps<a class="anchor" aria-label="anchor" href="#set-colors-for-change-maps"></a>
</h3>
<p>Before plotting the results, we can use the
<code><a href="../reference/colors_for_changes.html">colors_for_changes()</a></code> function to assign custom colors to
areas of gain, loss, and stability. By default, the function uses ‘teal
green’ for gains, ‘orange-red’ for losses, ‘Oxford blue’ for areas that
remain suitable, and ‘grey’ for areas that remain unsuitable. However,
you can customize these colors as needed.</p>
<p>The opacity of each color is automatically adjusted based on the
number of GCMs: it is highest (as defined by <code>max_alpha</code>)
when all GCMs agree on a prediction, and decreases progressively (down
to <code>min_alpha</code>) as fewer GCMs support that outcome.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Set colors for change maps</span></span>
<span><span class="va">changes_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colors_for_changes.html">colors_for_changes</a></span><span class="op">(</span><span class="va">changes</span><span class="op">)</span></span></code></pre></div>
<p>The function returns the same <code>changes_projections</code>
object, but with color tables embedded in its <code>SpatRasters</code>.
These colors are automatically applied when visualizing the data using
<code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="types-os-results">Types os results<a class="anchor" aria-label="anchor" href="#types-os-results"></a>
</h3>
<p>The <code><a href="../reference/projection_changes.html">projection_changes()</a></code> function returns four main
types of results: binarized models, results by GCM, results by change,
and a general summary considering all GCMs:</p>
<ul>
<li>
<strong>Binarized models for each GCM</strong>: These are
suitable/unsuitable maps binarized for each individual GCM. By default,
the binarization applies the omission error threshold used when
selecting the best models (e.g., 10%). You can specify a different
threshold using the <code>user_threshold</code> argument.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">changes_col</span><span class="op">$</span><span class="va">Binarized</span>, cex.main <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/binarized-1.png" width="672"></p>
<ul>
<li>
<strong>Results by gcm</strong>: provides the computed changes
(gain, loss, stability) for each GCM individually.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">changes_col</span><span class="op">$</span><span class="va">Results_by_gcm</span>, cex.main <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/results%20by%20gcm-1.png" width="672"></p>
<ul>
<li>
<strong>Results by change</strong>: a list where each
<code>SpatRaster</code> represents a specific type of change (e.g.,
gain, loss, stability) across all GCMs for a given scenario.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Results by change for the scenario of 2041-2060 (ssp126)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">changes_col</span><span class="op">$</span><span class="va">Results_by_change</span><span class="op">$</span><span class="va">`Future_2041-2060_ssp126`</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/Results_by_change-1.png" width="672"></p>
<ul>
<li>
<strong>Summary changes</strong>: provides a general summary
indicating how many GCMs project gain, loss, and stability for each
scenario.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">changes_col</span><span class="op">$</span><span class="va">Summary_changes</span>, </span>
<span>     plg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="co">#Decrease size of legend text</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/summary%20changes-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="importing-results">Importing Results<a class="anchor" aria-label="anchor" href="#importing-results"></a>
</h3>
<p>When <code>return_raster = TRUE</code> is set, the resulting
<code>SpatRaster</code> objects are returned within the
<code>changes</code> object. By default, however,
<code>return_raster = FALSE</code> and the object only contains the
directory path where the results were saved.</p>
<p>In this case, the saved results can be imported using the
<code><a href="../reference/import_projections.html">import_projections()</a></code> function. You can specify the type of
computed changes to import, along with the target period and emission
scenario.</p>
<p>A <code>changes_projections</code> object imported using
<code><a href="../reference/import_projections.html">import_projections()</a></code> can also be used as input to
<code><a href="../reference/colors_for_changes.html">colors_for_changes()</a></code> to customize the colors used for
plotting.</p>
<p>For example, below we import only the general summary for the
2041–2060 period under the SSP5-8.5 scenario:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">general_changes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_projections.html">import_projections</a></span><span class="op">(</span>projection <span class="op">=</span> <span class="va">changes</span>, </span>
<span>                                      future_period <span class="op">=</span> <span class="st">"2041-2060"</span>, </span>
<span>                                      future_pscen <span class="op">=</span> <span class="st">"ssp585"</span>,</span>
<span>                                      change_types <span class="op">=</span> <span class="st">"summary"</span><span class="op">)</span></span>
<span><span class="co">#Set colors</span></span>
<span><span class="va">general_changes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colors_for_changes.html">colors_for_changes</a></span><span class="op">(</span><span class="va">general_changes</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">general_changes</span><span class="op">$</span><span class="va">Summary</span>, main <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">general_changes</span><span class="op">$</span><span class="va">Summary</span><span class="op">)</span>,</span>
<span>     plg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="co">#Decrease size of legend text</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/import%20general%20summary-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="save-changes_projections">Save changes_projections<a class="anchor" aria-label="anchor" href="#save-changes_projections"></a>
</h3>
<p>The <code>changes_projections</code> object is a list that contains
the resulting <code>SpatRaster</code> objects (if
<code>return_raster = TRUE</code>) and the directory path where the
results were saved (if <code>write_results = TRUE</code>).</p>
<p>If the results were not written to disk during the initial run, you
can save the <code>SpatRaster</code> objects afterward using the
<code><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster()</a></code> function. For example, to save the general
summary raster:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">changes</span><span class="op">$</span><span class="va">Summary_changes</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_dir</span>, <span class="st">"Summary_changes.tif"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If the results were saved to disk, the
<code>changes_projections</code> object is automatically stored in a
folder named <em>Projection_changes</em> inside the specified
<code>output_dir</code>. You can load it back into R using
<code><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS()</a></code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">changes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_dir</span>, <span class="st">"Projection_changes/changes_projections.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>After loading, this object can be used to import specific results
with the <code><a href="../reference/import_projections.html">import_projections()</a></code> function.</p>
</div>
</div>
<div class="section level2">
<h2 id="explore-variance">Explore Variance<a class="anchor" aria-label="anchor" href="#explore-variance"></a>
</h2>
<p>When projecting niche models, predictions can vary across different
<strong>replicates</strong>, <strong>selected models</strong>, and
<strong>GCMs</strong>. The <code><a href="../reference/projection_variability.html">projection_variability()</a></code>
function quantifies and spatializes these sources of variability,
offering valuable insights into prediction uncertainty.</p>
<p>This function requires a <code>model_projections</code> object, which
is generated by the <code><a href="../reference/project_selected.html">project_selected()</a></code> function.</p>
<p>By default, <code><a href="../reference/projection_variability.html">projection_variability()</a></code> uses the
<strong>median consensus</strong> to summarize variance across selected
models and GCMs. Alternatively, users can specify other summary
statistics such as <code>mean</code>, <code>range</code>, or
<code>sd</code> (standard deviation).</p>
<p>To analyze variability originating from replicates, ensure that
<code>write_replicates = TRUE</code> is set when running
<code><a href="../reference/project_selected.html">project_selected()</a></code>.</p>
<p>Below, we demonstrate how to calculate variance from these different
sources (replicates, models, and GCMs) and save the results to the
designated <code>out_dir</code> directory.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a directory to save results</span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/projection_variability.html">projection_variability</a></span><span class="op">(</span>model_projections <span class="op">=</span> <span class="va">p</span>, write_files <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            output_dir <span class="op">=</span> <span class="va">out_dir</span>,</span>
<span>                            verbose <span class="op">=</span> <span class="cn">FALSE</span>, overwrite <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p>The output is a <code>variability_projections</code> object, a list
containing <code>SpatRaster</code> layers that represent the variance
attributed to replicates, models, and GCMs for each scenario, including
the present time. These results highlight areas where prediction
uncertainty is higher.</p>
<p>For example, for the present time scenario, the variance mainly
arises from differences among the replicates.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Variance for the present time</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">v</span><span class="op">$</span><span class="va">Present</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/plot%20variability%20present-1.png" width="60%"></p>
<p>In the most pessimistic scenario (SSP5-8.5) for the 2081–2100 period,
a slight variance is observed, primarily arising from the replicates and
the different GCMs used.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">v</span><span class="op">$</span><span class="va">`Future_2081-2100_ssp585`</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/plot%20variability%20future-1.png" width="672"></p>
<div class="section level3">
<h3 id="importing-results-1">Importing Results<a class="anchor" aria-label="anchor" href="#importing-results-1"></a>
</h3>
<p>Because <code>write_files = TRUE</code> was set, the
<code>variability_projections</code> object includes the file path where
the results were saved. You can use this path with the
<code><a href="../reference/import_projections.html">import_projections()</a></code> function to load the results whenever
needed.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># See the folder where the results were saved</span></span>
<span><span class="va">v</span><span class="op">$</span><span class="va">root_directory</span></span>
<span><span class="co">#&gt; [1] "Temp/Projection_results/maxnet/variance"</span></span></code></pre></div>
<p>As an example, we will import the results for the 2041–2060 period
under the SSP1-2.6 scenario. In this scenario, the variability mainly
originates from differences among the selected models.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v_2041_2060_ssp126</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_projections.html">import_projections</a></span><span class="op">(</span>projection <span class="op">=</span> <span class="va">v</span>, </span>
<span>                                         present <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#Do not import results from the present time</span></span>
<span>                                         future_period <span class="op">=</span> <span class="st">"2041-2060"</span>, </span>
<span>                                         future_pscen <span class="op">=</span> <span class="st">"ssp126"</span><span class="op">)</span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">v_2041_2060_ssp126</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/import%20variability_projections-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="saving-the-variability_projections-object">Saving the variability_projections Object<a class="anchor" aria-label="anchor" href="#saving-the-variability_projections-object"></a>
</h3>
<p>The <code>variability_projections</code> object is a list that
contains the resulting <code>SpatRaster</code> layers (if
<code>return_raster = TRUE</code>) and the directory path where the
results were saved (if <code>write_files = TRUE</code>).</p>
<p>If the results were not saved to disk during the initial run, you can
save the <code>SpatRaster</code> layers afterward using the
<code><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster()</a></code> function. For example, to save the
variability map for one of the future scenarios:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">v</span><span class="op">$</span><span class="va">`Future_2081-2100_ssp585`</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_dir</span>, <span class="st">"Future_2081-2100_ssp585.tif"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If the results were saved to disk, the
<code>variability_projections</code> object is automatically stored in a
folder named <em>variance</em> within the specified
<code>output_dir</code>. You can reload it into R using the
<code><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS()</a></code> function:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_dir</span>, <span class="st">"variance/variability_projections.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This object can then be used to import the results with the
<code><a href="../reference/import_projections.html">import_projections()</a></code> function.</p>
</div>
</div>
<div class="section level2">
<h2 id="analyze-extrapolation-risks-using-the-mop-metric">Analyze Extrapolation Risks Using the MOP Metric<a class="anchor" aria-label="anchor" href="#analyze-extrapolation-risks-using-the-mop-metric"></a>
</h2>
<p>When projecting model predictions to new regions or time periods, it
is common to encounter <strong>non-analogous conditions</strong>,
environmental conditions not present in the calibration area.</p>
<p>For example, the <strong>maximum temperature</strong> (bio_1) in our
model’s calibration area was
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>22.7</mn><mo>∘</mo></msup><mi>C</mi></mrow><annotation encoding="application/x-tex">22.7^\circ C</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">fitted_model_maxnet</span><span class="op">$</span><span class="va">calibration_data</span><span class="op">$</span><span class="va">bio_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 22.6858</span></span></code></pre></div>
<p>However, in future scenarios, conditions are projected to become
warmer, and temperatures may reach higher values. To illustrate this,
let’s import environmental variables from one of the GCMs (ACCESS-CM2)
under the future scenario SSP5-8.5 and examine the maximum
temperature:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Import variables from the 2081-2100 period (SSP585, GCM MIROC6)</span></span>
<span><span class="va">future_ACCESS_CM2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_dir_future</span>,</span>
<span>                                <span class="st">"2081-2100/ssp585/ACCESS-CM2/Variables.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">future_ACCESS_CM2</span><span class="op">$</span><span class="va">bio_1</span><span class="op">)</span></span>
<span><span class="co">#&gt;     bio_1</span></span>
<span><span class="co">#&gt; min  17.8</span></span>
<span><span class="co">#&gt; max  29.6</span></span>
<span></span>
<span><span class="co">#Plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">future_ACCESS_CM2</span><span class="op">$</span><span class="va">bio_1</span>, </span>
<span>     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">22.7</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span> <span class="co">#Highlight regions with temperature above 22.7ºC</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/Highlight%20non-analogous-1.png" width="672"></p>
<p>Note that in most of the projected area, temperatures are expected to
exceed the current maximum temperature.</p>
<p>The <code><a href="../reference/projection_mop.html">projection_mop()</a></code> function performs Mobility-Oriented
Parity (MOP) analysis (<a href="https://doi.org/10.1016/j.ecolmodel.2013.04.011" class="external-link">Owens et
al. 2013</a>), which identifies areas with non-analogous environmental
conditions that pose extrapolation risks. It also quantifies how
dissimilar conditions in the projection area are relative to the
calibration data.</p>
<p>The MOP analysis requires the following inputs:</p>
<ul>
<li>An object of class <code>fitted_models</code> returned by the
<code><a href="../reference/fit_selected.html">fit_selected()</a></code> function, or an object of class
<code>prepared_data</code> returned by <code><a href="../reference/prepare_data.html">prepare_data()</a></code>.
These objects contain the calibration data defining the environmental
conditions used during model training.
<ul>
<li>If you wish to perform MOP only on the variables used in the
selected models, set <code>subset_variables = TRUE</code> and provide a
<code>fitted_models</code> object.</li>
</ul>
</li>
<li>An object of class <code>projection_data</code> returned by the
<code><a href="../reference/prepare_projection.html">prepare_projection()</a></code> function, which contains the paths to
raster layers representing environmental conditions in the projected
scenarios.</li>
</ul>
<p>By default, <code><a href="../reference/projection_mop.html">projection_mop()</a></code> performs a <em>basic</em>
MOP, which highlights regions with non-analogous conditions relative to
the calibration data. Alternatively, you can set: -
<code>type = "simple"</code> to compute the number of variables with
non-analogous conditions per location. - <code>type = "detailed"</code>
to identify exactly which variables exhibit non-analogous
conditions.</p>
<p>Below, we perform a detailed MOP to identify areas with extrapolation
risk in the future scenarios for which predictions were made:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a folder to save MOP results</span></span>
<span><span class="va">out_dir_mop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"MOPresults"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">out_dir_mop</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run MOP</span></span>
<span><span class="va">kmop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/projection_mop.html">projection_mop</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, projection_data <span class="op">=</span> <span class="va">pr</span>, </span>
<span>                       subset_variables <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                       calculate_distance <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                       out_dir <span class="op">=</span> <span class="va">out_dir_mop</span>, </span>
<span>                       type <span class="op">=</span> <span class="st">"detailed"</span>, </span>
<span>                       overwrite <span class="op">=</span> <span class="cn">TRUE</span>, progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The function returns a <code>mop_projections</code> object, which
contains the paths to the directories where the results were saved. This
object can be used with the <code><a href="../reference/import_projections.html">import_projections()</a></code> function
to load the results.</p>
<div class="section level3">
<h3 id="mop-types">MOP types<a class="anchor" aria-label="anchor" href="#mop-types"></a>
</h3>
<p>The results of the MOP analysis provide multiple perspectives on
extrapolation risks. Each component of the <code>mop_projections</code>
object captures a different aspect of the dissimilarity between
environmental conditions in the calibration and projection areas.</p>
<p>When importing results, you can specify the scenarios (e.g.,
“2081-2100” and “ssp585”) as well as the type of MOP results to load. By
default, all available MOP types are imported, including:</p>
<ul>
<li><strong>basic</strong></li>
<li><strong>simple</strong></li>
<li><strong>towards_high_combined</strong></li>
<li><strong>towards_low_combined</strong></li>
<li><strong>towards_high_end</strong></li>
<li><strong>towards_low_end</strong></li>
</ul>
<p>Below, we examine all MOP results for the SSP5-8.5 scenario during
the 2081–2100 period:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mop_ssp585_2100</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_projections.html">import_projections</a></span><span class="op">(</span>projection <span class="op">=</span> <span class="va">kmop</span>,</span>
<span>                                      future_period <span class="op">=</span> <span class="st">"2081-2100"</span>, </span>
<span>                                      future_pscen <span class="op">=</span> <span class="st">"ssp585"</span><span class="op">)</span></span>
<span><span class="co">#See types of results</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mop_ssp585_2100</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "distances"             "simple"                "basic"                </span></span>
<span><span class="co">#&gt; [4] "towards_high_combined" "towards_low_combined"  "towards_high_end"     </span></span>
<span><span class="co">#&gt; [7] "towards_low_end"</span></span></code></pre></div>
<div class="section level4">
<h4 id="distances">Distances<a class="anchor" aria-label="anchor" href="#distances"></a>
</h4>
<p>The <em>distances</em> result represents the Euclidean or Mahalanobis
distance between the projected environmental conditions (G) and those in
the calibration dataset (M). Higher distance values indicate greater
dissimilarity from the calibration conditions, highlighting areas with
increased extrapolation risk.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mop_ssp585_2100</span><span class="op">$</span><span class="va">distances</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/plot%20distance-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="basic">Basic<a class="anchor" aria-label="anchor" href="#basic"></a>
</h4>
<p>The <em>basic</em> result identifies areas where at least one
environmental variable differs from the reference (calibration)
conditions. A value of ‘1’ indicates the presence of non-analogous
conditions in that specific area and scenario.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mop_ssp585_2100</span><span class="op">$</span><span class="va">basic</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/plot%20basic-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="simple">Simple<a class="anchor" aria-label="anchor" href="#simple"></a>
</h4>
<p>The <em>simple</em> result quantifies the number of environmental
variables in the projected area that are non-analogous to those in the
calibration data.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mop_ssp585_2100</span><span class="op">$</span><span class="va">simple</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/plot%20simple-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="combined-towards-highlow">Combined Towards High/Low<a class="anchor" aria-label="anchor" href="#combined-towards-highlow"></a>
</h4>
<p>The <em>towards_high_combined</em> and <em>towards_low_combined</em>
results identify which variables exhibit non-analogous conditions.
Specifically, <em>towards_high_combined</em> highlights variables with
values exceeding those observed in the calibration data, while
<em>towards_low_combined</em> highlights variables with values below the
calibration range.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Non-analogous conditions towards high values</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mop_ssp585_2100</span><span class="op">$</span><span class="va">towards_high_combined</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/plot%20towars%20combined-1.png" width="672"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Non-analogous conditions towards low values</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mop_ssp585_2100</span><span class="op">$</span><span class="va">towards_low_combined</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/plot%20towars%20combined-2.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="towards-highlow-end">Towards High/Low End<a class="anchor" aria-label="anchor" href="#towards-highlow-end"></a>
</h4>
<p>The <em>towards_high_end</em> and <em>towards_low_end</em> results
are similar to their “combined” counterparts but provide individual
<code>SpatRaster</code> layers for each variable.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Non-analogous conditions towards high values in the ACCESS-CM2 scenario</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mop_ssp585_2100</span><span class="op">$</span><span class="va">towards_high_end</span><span class="op">$</span><span class="va">`Future_2081-2100_ssp585_ACCESS-CM2`</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/plot%20towards%20end-1.png" width="672"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Non-analogous conditions towards low values in the MIROC6 scenario</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mop_ssp585_2100</span><span class="op">$</span><span class="va">towards_low_end</span><span class="op">$</span><span class="va">`Future_2081-2100_ssp585_ACCESS-CM2`</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mop_ssp585_2100</span><span class="op">$</span><span class="va">towards_low_end</span><span class="op">$</span><span class="va">`Future_2081-2100_ssp585_ACCESS-CM2`</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/plot%20towards%20end-2.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="handling-in-range-values-na-or-zero">Handling In-Range Values: NA or Zero<a class="anchor" aria-label="anchor" href="#handling-in-range-values-na-or-zero"></a>
</h3>
<p>By default, the <code><a href="../reference/projection_mop.html">projection_mop()</a></code> function assigns
<code>NA</code> to cells whose values fall within the range of the
calibration data, indicating they are considered analogous.
Alternatively, you can assign a value of 0 to these cells by setting
<code>na_in_range = FALSE</code> when running
<code><a href="../reference/projection_mop.html">projection_mop()</a></code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a folder to save MOP results, now assigning 0 to cells within the range</span></span>
<span><span class="va">out_dir_mop_zero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"MOPresults_zero"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">out_dir_mop_zero</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run MOP</span></span>
<span><span class="va">kmop_zero</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/projection_mop.html">projection_mop</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, projection_data <span class="op">=</span> <span class="va">pr</span>, </span>
<span>                            subset_variables <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                            na_in_range <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#Assign 0 to cells within range</span></span>
<span>                            calculate_distance <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            out_dir <span class="op">=</span> <span class="va">out_dir_mop_zero</span>, </span>
<span>                            type <span class="op">=</span> <span class="st">"detailed"</span>, </span>
<span>                            overwrite <span class="op">=</span> <span class="cn">TRUE</span>, progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Let’s explore how this setting affects the <em>simple</em> and
<em>detailed</em> MOP outputs:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import MOP for the scenario ssp585 in 2081-2100</span></span>
<span><span class="va">mop_ssp585_2100_zero</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_projections.html">import_projections</a></span><span class="op">(</span>projection <span class="op">=</span> <span class="va">kmop_zero</span>,</span>
<span>                                           future_period <span class="op">=</span> <span class="st">"2081-2100"</span>, </span>
<span>                                           future_pscen <span class="op">=</span> <span class="st">"ssp585"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare with the MOP that assigns NA to cells within the calibration range</span></span>
<span><span class="co"># Simple MOP</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mop_ssp585_2100</span><span class="op">$</span><span class="va">simple</span><span class="op">$</span><span class="va">`Future_2081-2100_ssp585_ACCESS-CM2`</span>, </span>
<span>       <span class="va">mop_ssp585_2100_zero</span><span class="op">$</span><span class="va">simple</span><span class="op">$</span><span class="va">`Future_2081-2100_ssp585_ACCESS-CM2`</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Within range as NA"</span>, <span class="st">"Within range as 0"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/check%20difference%20zero%20mop-1.png" width="672"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Detailed MOP</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mop_ssp585_2100</span><span class="op">$</span><span class="va">towards_high_combined</span><span class="op">$</span><span class="va">`Future_2081-2100_ssp585_ACCESS-CM2`</span>, </span>
<span>       <span class="va">mop_ssp585_2100_zero</span><span class="op">$</span><span class="va">towards_high_combined</span><span class="op">$</span><span class="va">`Future_2081-2100_ssp585_ACCESS-CM2`</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Within range as NA"</span>, <span class="st">"Within range as 0"</span><span class="op">)</span>,</span>
<span>     plg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/check%20difference%20zero%20mop-2.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="comparing-mop-results-with-response-curves">Comparing MOP Results with Response Curves<a class="anchor" aria-label="anchor" href="#comparing-mop-results-with-response-curves"></a>
</h3>
<p>While the <code><a href="../reference/projection_mop.html">projection_mop()</a></code> function identifies areas
with non-analogous environmental conditions, <strong>the actual risk of
extrapolation depends strongly on additional factors</strong>,
especially the response curves of the environmental variables.</p>
<p>For example, consider a future scenario predicted by a GCM (e.g.,
ACCESS-CM2 under SSP5-8.5 for 2081–2100), where values of bio_1 (Annual
Mean Temperature), bio_12 (Annual Precipitation) and bio_15
(Precipitation Seasonality) exceed the upper limits observed in the
calibration data.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Non-analogous conditions towards high values in the MIROC6 scenario</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mop_ssp585_2100</span><span class="op">$</span><span class="va">towards_high_combined</span><span class="op">$</span><span class="va">`Future_2081-2100_ssp585_ACCESS-CM2`</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/plot%20towards%20high%20values-1.png" width="672"></p>
<p>Now, let’s examine the response curves for these variables. To better
visualize how the model responds to the range of values projected in
this future scenario, we can set the plotting limits using the
scenario’s variable values as <code>new_data</code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="co">#Set plot grid</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, variable <span class="op">=</span> <span class="st">"bio_1"</span>, </span>
<span>               new_data <span class="op">=</span> <span class="va">future_ACCESS_CM2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, variable <span class="op">=</span> <span class="st">"bio_12"</span>, </span>
<span>               new_data <span class="op">=</span> <span class="va">future_ACCESS_CM2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, variable <span class="op">=</span> <span class="st">"bio_15"</span>, </span>
<span>               new_data <span class="op">=</span> <span class="va">future_ACCESS_CM2</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/response%20curves%20towards%20high-1.png" width="672"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Reinitiate grids</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>In the response curves for bio_1, bio_12, and bio_15, higher values
correspond to lower suitability, reaching zero near the upper limit of
the calibration data (indicated by a dashed line). Beyond this upper
limit, suitability remains close to zero. Given this pattern, it is
unlikely that suitability would increase suddenly at even higher values,
which provides greater confidence in the model’s extrapolation for these
variables.</p>
<p>Next, let’s investigate the variables with values below the lower
limit of the calibration data:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Non-analogous conditions towards low values in the MIROC6 scenario</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co">#Set grid</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mop_ssp585_2100</span><span class="op">$</span><span class="va">towards_low_combined</span><span class="op">$</span><span class="va">`Future_2081-2100_ssp585_ACCESS-CM2`</span><span class="op">)</span></span>
<span><span class="co">## It's bio 7. Plot response curve:</span></span>
<span><span class="fu"><a href="../reference/response_curve.html">response_curve</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">fitted_model_maxnet</span>, variable <span class="op">=</span> <span class="st">"bio_7"</span>, </span>
<span>               new_data <span class="op">=</span> <span class="va">future_ACCESS_CM2</span><span class="op">)</span></span></code></pre></div>
<p><img src="variability_and_uncertainty_files/figure-html/plot%20towards%20low%20values-1.png" width="672"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Reinitiate grid</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>In some regions of the projected scenario, <code>bio_7</code>
(Temperature Annual Range) exhibits values <strong>below the lower limit
of the calibration data</strong>. The response curve indicates that,
when extrapolating to these lower values, suitability continues to
increase. This situation represents a <strong>higher risk of
extrapolation</strong> and <strong>substantial uncertainty</strong>, as
we don’t know whether suitability truly continues to rise at these low
<code>bio_7</code> values or if (and where) it might eventually
decline.</p>
<p>This example highlights why we strongly recommend interpreting MOP
results alongside the response curves.</p>
</div>
<div class="section level3">
<h3 id="saving-and-importing-mop-results">Saving and Importing MOP Results<a class="anchor" aria-label="anchor" href="#saving-and-importing-mop-results"></a>
</h3>
<p>When <code><a href="../reference/projection_mop.html">projection_mop()</a></code> is run, it automatically saves the
<code>mop_projections</code> object as an RDS file in the specified
<code>out_dir</code>. You can reload this object in R at any time using
the <code><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS()</a></code> function:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check for RDS files in the directory where we saved the MOP results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">out_dir_mop</span>, pattern <span class="op">=</span> <span class="st">"rds"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "mop_projections.rds"</span></span>
<span></span>
<span><span class="co"># Import the mop_projections file</span></span>
<span><span class="va">kmop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_dir_mop</span>, <span class="st">"mop_projections.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Weverton C. F. Trindade, Luis F. Arias-Giraldo, Luis Osorio-Olvera, A. Townsend Peterson, Marlon E. Cobos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
